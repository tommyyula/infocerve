---
inclusion: manual
---

# 任务归档指南

## 📋 概述

任务归档功能帮助你将已完成的任务（spec）整理归档到 `.task-manager` 目录，便于历史追溯和项目管理。

## 🎯 何时使用任务归档

当你完成一个 spec 的所有任务后，可以使用任务归档功能：

- ✅ 所有任务已完成并测试通过
- ✅ 代码已合并到主分支
- ✅ 需要清理工作区，开始新任务
- ✅ 需要保留完整的任务历史记录

## 🚀 快速开始

### 触发归档

在对话中输入以下任何一个命令：

```
任务归档
归档任务
archive task
```

### 归档流程

1. **AI 会询问你以下信息**：
   ```
   请提供以下信息：
   1. 归档目录名称（建议格式：YYYY-MM-任务编号-简短描述）
      例如：2025-12-WCS-1495-iam-refactor
   2. 要归档的 spec 目录名称（如：iam-user-system-refactor）
   3. 是否需要生成任务总结？（是/否）
   ```

2. **你提供信息**：
   ```
   归档目录名称：2025-12-WCS-1495-iam-refactor
   spec 目录：iam-user-system-refactor
   生成总结：是
   ```

3. **AI 执行归档**：
   - 创建归档目录
   - 复制 spec 文件（requirements.md, design.md）
   - 导出 task-manager 任务列表到归档目录
   - 移动相关 memory 文件
   - 生成任务总结（如果选择）
   - 更新归档索引

## 📁 归档目录结构

归档后的目录结构如下：

```
.task-manager/
├── {你的用户名}/
│   ├── memory/                    # 当前活跃任务的 memory 文件
│   ├── archive/                   # 归档目录
│   │   ├── 2025-12-WCS-1495-iam-refactor/
│   │   │   ├── requirements.md    # 需求文档
│   │   │   ├── design.md          # 设计文档
│   │   │   ├── tasks-export.json  # task-manager 导出的任务列表
│   │   │   ├── summary.md         # 任务总结（自动生成）
│   │   │   ├── archive-info.json  # 归档元数据
│   │   │   └── memory/            # 相关的 memory JSON 文件
│   │   └── 2025-11-WCS-1493-itemmaster/
│   │       └── ...
│   ├── archive-index.md           # 归档索引（便于查找）
│   └── tasks.json
```

## 📝 归档目录命名规范

### 推荐格式

```
YYYY-MM-任务编号-简短描述
```

### 示例

- ✅ `2025-12-WCS-1495-iam-refactor`
- ✅ `2025-11-WCS-1493-itemmaster-migration`
- ✅ `2025-10-FEATURE-menu-tree-optimization`
- ❌ `iam-refactor`（缺少日期和任务编号）
- ❌ `2025-12-08-iam`（日期太详细，描述太简短）

### 命名建议

- **日期**：使用年-月格式（YYYY-MM），便于按时间排序
- **任务编号**：使用项目管理系统的任务编号（如 WCS-1495, JIRA-123）
- **描述**：简短但清晰的描述（3-5个单词，使用连字符分隔）
- **语言**：建议使用英文，便于跨团队协作

## 🔍 查询归档任务

### 查看归档列表

```
查看归档任务列表
查看归档
list archives
```

AI 会显示你的所有归档任务：

```markdown
# 归档任务列表

## 2025年12月

### WCS-1495 - IAM 用户系统重构
- **归档目录**：`archive/2025-12-WCS-1495-iam-refactor/`
- **完成时间**：2025-12-08
- **耗时**：10天
- **状态**：已完成
- **标签**：iam, refactor, ddd

### WCS-1493 - ItemMaster 迁移
- **归档目录**：`archive/2025-11-WCS-1493-itemmaster-migration/`
- **完成时间**：2025-11-20
- **耗时**：5天
- **状态**：已完成
- **标签**：migration, mdm
```

### 查看归档详情

```
查看归档任务 WCS-1495
查看归档详情 2025-12-WCS-1495-iam-refactor
```

AI 会显示该归档任务的详细信息，包括：
- 任务总结
- 完成的工作
- 遇到的问题
- 经验教训

## 🔄 恢复归档任务

如果需要重新查看或继续某个归档任务：

```
恢复归档任务 WCS-1495
恢复归档 2025-12-WCS-1495-iam-refactor
```

AI 会将归档文件复制回 `.kiro/specs/` 目录。

## 📊 任务总结内容

如果选择生成任务总结，AI 会自动创建 `summary.md`，包含：

### 1. 基本信息
- 任务编号
- 任务名称
- 负责人
- 开始时间
- 完成时间
- 总耗时

### 2. 完成的工作
- 从 task-manager 中提取所有已完成的任务
- 按模块分组
- 包含时间记录

### 3. 遇到的问题
- 从任务记录中提取问题和解决方案
- 按严重程度分类

### 4. 经验教训
- 总结开发过程中的经验
- 提出改进建议

### 5. 技术债务
- 列出遗留的 TODO
- 标注优先级

## 💡 最佳实践

### 1. 及时归档
- ✅ 任务完成后立即归档
- ✅ 不要积累太多已完成的任务
- ✅ 保持工作区整洁

### 2. 规范命名
- ✅ 使用统一的命名格式
- ✅ 包含日期、任务编号和描述
- ✅ 使用英文命名（便于跨团队协作）

### 3. 生成总结
- ✅ 重要任务必须生成总结
- ✅ 记录经验教训
- ✅ 便于后续回顾

### 4. 定期回顾
- ✅ 每月回顾归档任务
- ✅ 总结团队经验
- ✅ 改进开发流程

## 🔧 高级功能

### 批量归档

如果有多个任务需要归档：

```
批量归档以下任务：
1. iam-user-system-refactor -> 2025-12-WCS-1495-iam-refactor
2. itemmaster-migration -> 2025-11-WCS-1493-itemmaster-migration
```

### 归档搜索

按标签或关键词搜索归档任务：

```
搜索归档任务：iam
搜索归档任务：refactor
```

### 导出归档报告

生成归档任务的统计报告：

```
导出归档报告
生成归档统计
```

## 📋 归档检查清单

在归档任务前，请确认：

- [ ] 所有任务已完成（task-manager 中所有任务都标记为完成）
- [ ] 代码已合并到主分支
- [ ] 所有测试通过
- [ ] 文档已更新
- [ ] TODO 已记录（如果有）
- [ ] 准备好归档目录名称
- [ ] 确认 spec 目录名称

## ❓ 常见问题

### Q1: 归档后原始 spec 文件会被删除吗？

A: 不会。归档操作只是复制文件到归档目录，原始文件保留在 `.kiro/specs/` 中。你可以手动删除或保留。

### Q2: 可以修改已归档的任务吗？

A: 可以。归档文件是普通的 Markdown 文件，你可以随时编辑。但建议不要频繁修改，保持归档的完整性。

### Q3: 归档的 memory 文件是如何选择的？

A: AI 会根据任务编号、日期范围和文件名匹配相关的 memory JSON 文件。如果有遗漏，你可以手动移动。

### Q4: 可以归档未完成的任务吗？

A: 可以，但不推荐。归档功能主要用于已完成的任务。如果需要暂停任务，建议使用其他方式管理。

### Q5: 归档目录可以重命名吗？

A: 可以。但重命名后需要手动更新 `archive-index.md` 和 `archive-info.json` 中的引用。

## 🎓 示例场景

### 场景 1：完成 IAM 重构任务

```
用户：任务归档

AI：请提供以下信息：
1. 归档目录名称（建议格式：YYYY-MM-任务编号-简短描述）
2. 要归档的 spec 目录名称
3. 是否需要生成任务总结？

用户：
归档目录名称：2025-12-WCS-1495-iam-refactor
spec 目录：iam-user-system-refactor
生成总结：是

AI：开始归档任务...
✅ 创建归档目录：.task-manager/neil-chen/archive/2025-12-WCS-1495-iam-refactor/
✅ 复制 requirements.md
✅ 复制 design.md
✅ 导出 task-manager 任务列表
✅ 移动 memory 文件（3个文件）
✅ 生成任务总结
✅ 更新归档索引

归档完成！你可以通过以下命令查看：
- 查看归档列表：查看归档任务列表
- 查看详情：查看归档任务 WCS-1495
```

### 场景 2：查看历史任务

```
用户：查看归档任务列表

AI：[显示归档列表]

用户：查看归档任务 WCS-1495

AI：[显示任务详情和总结]
```

## 📞 获取帮助

如果遇到问题或有建议，可以：

1. 在对话中询问：`任务归档帮助` 或 `archive help`
2. 查看本文档：`.kiro/steering/task-archive-guide.md`
3. 联系团队管理员

## 🔄 版本历史

- **v1.0** (2025-12-09)
  - 初始版本
  - 支持基本归档功能
  - 支持任务总结生成
  - 支持归档索引

---

**记住**：及时归档，保持工作区整洁，便于团队协作和知识传承！

*最后更新：2025-12-09*
