---
inclusion: manual
---

# 领域建模编写规范（战术设计）

## 文件位置

```
.kiro/specs/{feature-name}/04-domain-model.md
```

---

## 核心原则

[重要] 关注点分离原则：

领域模型关注：
- 业务概念和术语
- 聚合边界和职责
- 业务规则和约束
- 领域事件

领域模型不关注：
- 具体数据类型（String、Integer 等）
- 字段长度限制
- 数据库存储方式
- 技术实现细节

---

## 模板结构

```markdown
# {功能名称} - 领域建模

## 1. 聚合设计概览
## 2. 聚合详细设计（每个聚合一节）
## 3. 仓储接口
## 4. 领域服务
## 5. 领域事件
```

---

## 1. 聚合设计

### 属性描述规范

[重要] 使用业务语言，不指定技术类型

推荐格式：
```
- {属性名} - {业务含义}（{约束条件}）
```

示例：
```
- facilityCode - 设施编码（唯一，不可变）
- facilityName - 设施名称（必填，最大长度 128）
- facilityType - 设施类型（WAREHOUSE/DISTRIBUTION_CENTER/STORE）
- enabled - 启用状态（默认 true）
- createdTime - 创建时间（系统自动生成）
- updatedTime - 更新时间（系统自动维护）
- address - 地址信息（值对象，包含国家、省份、城市等）
- capabilities - 设施能力列表（可选，支持多个能力）
```

约束条件说明：
- 唯一：该字段在系统中必须唯一
- 不可变：创建后不允许修改
- 必填：创建时必须提供
- 可选：创建时可以不提供
- 默认值：如果不提供，系统使用默认值
- 最大长度：字符串的最大长度限制
- 枚举值：列出所有可能的值
- 系统自动生成/维护：由系统自动处理，用户不需要提供

禁止格式：
```
- facilityCode: String - 设施编码
- facilityName: VARCHAR(128) - 设施名称
- createdTime: LocalDateTime - 创建时间
- capabilities: List<String> - 设施能力列表
```

技术类型（String、Integer、LocalDateTime、List、VARCHAR、INT 等）在阶段 7 Database Design 中定义

### 聚合结构描述

聚合根：
- 名称和职责
- 属性列表（业务语言）
- 行为方法（业务操作）

实体：
- 名称和职责
- 属性列表
- 与聚合根的关系

值对象：
- 名称和业务含义
- 包含的业务属性
- 业务约束规则

聚合边界规则：
- 一个事务一个聚合 - 事务边界不跨聚合
- 通过聚合根访问 - 外部不直接访问聚合内实体
- ID 引用 - 聚合间通过 ID 引用
- 小聚合原则 - 聚合尽量小

---

## 2. 实体设计

实体特征：
- 唯一标识 - 有 ID，生命周期内不变
- 可变性 - 属性可以变化
- 生命周期 - 有创建、修改、删除
- 业务行为 - 包含业务方法

状态机设计：
```
DRAFT -> CONFIRMED -> COMPLETED
  |          |
  v          v
CANCELLED
```

---

## 3. 值对象设计

值对象特征：
- 无标识 - 没有 ID
- 不可变 - 创建后不能修改
- 值相等 - 通过属性值判断相等
- 可替换 - 整体替换而非修改

常用值对象类型：
- 标识类：ItemId, OrderId - 封装 ID，类型安全
- 数量类：Quantity, Money - 数值 + 单位
- 编码类：ItemCode, OrderNo - 业务编码
- 范围类：DateRange, QuantityRange - 区间值
- 组合类：Address, Contact - 多属性组合

值对象描述示例：
```
Address（地址）:
- country - 国家
- province - 省份
- city - 城市
- district - 区县
- street - 街道
- postalCode - 邮编
- detail - 详细地址
```

---

## 4. 领域服务

使用场景：
- 跨聚合操作 - 涉及多个聚合的业务逻辑
- 无状态计算 - 不属于任何实体的计算
- 外部依赖 - 需要调用外部服务

服务方法描述：
- 方法名称（业务语言）
- 业务职责说明
- 业务规则列表

---

## 5. 领域事件

事件命名规范：{聚合名}{动作过去式}Event

示例：
- InboundOrderCreatedEvent - 入库单已创建
- InboundOrderConfirmedEvent - 入库单已确认
- InventoryChangedEvent - 库存已变动

事件结构：
- eventId - 事件唯一ID
- occurredAt - 发生时间
- aggregateId - 聚合ID
- payload - 事件数据（业务属性）

---

## 6. 仓储接口

仓储设计规则：
- 只操作聚合根 - 不直接操作聚合内实体
- 接口在领域层 - 实现在基础设施层
- 返回领域对象 - 不返回 PO 或 DTO
- 封装查询逻辑 - 复杂查询封装在仓储中

仓储方法描述：
- 方法签名（使用领域对象）
- 方法职责说明

---

## 检查清单

聚合设计：
- [ ] 聚合根有唯一标识
- [ ] 聚合边界清晰
- [ ] 聚合间通过 ID 引用
- [ ] 聚合方法包含业务规则
- [ ] 属性使用业务语言描述
- [ ] 不包含技术类型（String、Integer 等）

实体设计：
- [ ] 实体有唯一标识
- [ ] 业务方法在实体中
- [ ] 状态变化有状态机描述

值对象设计：
- [ ] 值对象不可变
- [ ] 描述业务含义
- [ ] 包含必要的业务约束

领域服务：
- [ ] 只用于跨聚合逻辑
- [ ] 无状态
- [ ] 使用业务语言描述

领域事件：
- [ ] 事件命名符合规范
- [ ] 携带必要业务数据
- [ ] 订阅者明确

仓储接口：
- [ ] 只操作聚合根
- [ ] 接口定义在领域层
- [ ] 使用领域对象
