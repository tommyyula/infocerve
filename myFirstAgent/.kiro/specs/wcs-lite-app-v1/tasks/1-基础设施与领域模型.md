# WCS-1647 wcs-lite-app v1 版本后端开发——1-基础设施与领域模型

## 任务概述

- **Jira Issue**: WCS-1647
- **预估工时**: 5 人天（40 小时）
- **前置依赖**: 无
- **后续任务**: WCS-1648

> **[架构说明]** WCS-Lite V1 采用三应用架构，本任务同时覆盖三个模块的基础设施与领域模型：
> - wcs-lite-app：Job/Task/Workflow 业务逻辑、Flowable BPMN 流程编排
> - facility-app：Zone/Station/Device/StationDevice 资源数据管理
> - device-app：RCS 对接、设备驱动、RcsVendor/RcsMission 管理

## 参考文档

- 需求文档: [requirements.md](../requirements.md)
- 设计文档: [design.md](../design.md)
  - 第二章「模块结构设计」- 项目结构、三应用架构
  - 第三章「领域模型设计」- 所有实体定义
  - 第七章「数据库设计」- 所有表结构

---

## 任务清单

### 任务 1.1：三模块项目骨架与基础配置（8h）

**目标**: 搭建 wcs-lite-app、facility-app 和 device-app 三个模块的基础框架

**交付物**:

**wcs-lite-app 模块**:
- [ ] 创建 wcs-lite-app-v1 Gradle 模块
- [ ] 配置 build.gradle 依赖（Flowable、RabbitMQ、MyBatis-Plus）
- [ ] 创建包结构
  ```
  com.t5.wcs/
  ├── interfaces/          # L1 接入层
  ├── application/         # L2 业务编排层
  ├── domain/              # 领域层
  └── infrastructure/      # 基础设施层
  ```
- [ ] 配置 application.yml（数据源、Flowable、RabbitMQ）
- [ ] 创建 WcsLiteConfig 配置类（@RefreshScope）

**device-app 模块**:
- [ ] 创建 device-app Gradle 模块（如不存在）
- [ ] 配置 build.gradle 依赖（MyBatis-Plus、RestTemplate）
- [ ] 创建包结构
  ```
  com.t5.device/
  ├── interfaces/          # 接入层（RCS API）
  ├── application/         # 应用层
  ├── domain/              # 领域层
  └── infrastructure/      # 基础设施层
  ```
- [ ] 配置 application.yml（数据源、RCS 厂商配置）
- [ ] 创建 DeviceAppConfig 配置类

**facility-app 模块**:
- [ ] 创建 facility-app Gradle 模块（如不存在）
- [ ] 配置 build.gradle 依赖（MyBatis-Plus）
- [ ] 创建包结构
  ```
  com.t5.facility/
  ├── interfaces/          # 接入层（资源管理 API）
  ├── application/         # 应用层
  ├── domain/              # 领域层
  └── infrastructure/      # 基础设施层
  ```
- [ ] 配置 application.yml（数据源）
- [ ] 创建 FacilityAppConfig 配置类

**参考**: design.md 第 2.1-2.2 节「项目结构」

---

### 任务 1.2：枚举与异常定义（4h）

**目标**: 建立三个模块的基础类型定义

**交付物**:

**wcs-lite-app 枚举**:
- [ ] JobType（OUTBOUND, EMPTY_CONTAINER_RETURN, REPLENISHMENT, TRANSFER, INVENTORY）
- [ ] JobStatus（PENDING, IN_PROGRESS, COMPLETED, FAILED, CANCELLED）
- [ ] TaskType（RCS_MISSION, ASRS_PICK, ASRS_PUT, HUMAN_TASK, DEVICE_IO）
- [ ] TaskStatus（PENDING, DISPATCHED, IN_PROGRESS, COMPLETED, FAILED, CANCELLED）
- [ ] WorkflowStatus（RUNNING, COMPLETED, FAILED, CANCELLED, PAUSED）
- [ ] NodeStatus（PENDING, RUNNING, WAITING, COMPLETED, FAILED, SKIPPED）
- [ ] NodeType（RCS_MISSION, ASRS_PICK, ASRS_PUT, HUMAN_TASK, DEVICE_IO, DECISION, SUB_WORKFLOW）
- [ ] WcsErrorCode 错误码枚举（5001-5999）
- [ ] WcsException 异常类
- [ ] WcsConstants 常量类

---

### 任务 1.2.1：状态机四层枚举（原wcs-app完整迁移）（2h）

**目标**: 迁移原wcs-app的完整状态枚举，确保状态机一致性

**[重要] 状态机四层结构**:
- Job -> Task -> Step -> Command
- 每层有独立的状态枚举，状态变更需要级联处理

**交付物**:

**TaskStatus（任务状态 - 8种）**:
- [ ] NEW - 新建
- [ ] UNASSIGNED - 未分配
- [ ] DECISION_ON - 决策中
- [ ] IN_PROGRESS - 执行中
- [ ] CLOSED - 已完成
- [ ] EXCEPTION - 异常
- [ ] CANCELLED - 已取消
- [ ] CANCELLING - 取消中

**StepStatus（步骤状态 - 6种）**:
- [ ] NEW - 新建
- [ ] IN_PROGRESS - 执行中
- [ ] CLOSED - 已完成
- [ ] EXCEPTION - 异常
- [ ] CANCELLED - 已取消
- [ ] CANCELLING - 取消中

**CmdStatus（命令状态 - 9种）**:
- [ ] NEW - 新建，等待发送
- [ ] SENDING - 发送中
- [ ] ACCEPTED - 已接受（设备确认收到）
- [ ] IN_PROGRESS - 执行中
- [ ] PENDING - 挂起（等待条件）
- [ ] CLOSED - 已完成
- [ ] EXCEPTION - 异常
- [ ] CANCELLED - 已取消
- [ ] PAUSED - 暂停

**ActionStatus（动作状态 - 7种）**:
- [ ] PENDING - 待处理
- [ ] ASSIGNED - 已分配
- [ ] IN_PROGRESS - 执行中
- [ ] COMPLETED - 已完成
- [ ] FAILED - 失败
- [ ] CANCELLED - 已取消
- [ ] SKIPPED - 已跳过

**状态级联关系**:
- Command完成 -> 检查Step下所有Command -> Step完成
- Step完成 -> 检查Task下所有Step -> Task完成
- Task完成 -> 检查Job下所有Task -> Job完成

**参考**: design.md 第234-240轮状态机分析

---

### 任务 1.2.2：业务枚举完整迁移（原wcs-app 50+种）（3h）

**目标**: 迁移原wcs-app的完整业务枚举

**TaskType（任务类型 - 原代码20+种）**:
- 基础类型：TOTE_MOVEMENT, EMPTY_TOTE_OUTBOUND, REQUEST_IDLE_ROBOT, RELEASE_AGV
- 补货类型：REPLENISHMENT, CASE_REPLENISHMENT
- 空箱类型：EMPTY_TOTE_OUTBOUND, EMPTY_TOTE_INBOUND
- 整箱类型：CASE_INBOUND, CASE_OUTBOUND
- 特殊类型：WALL_PICK_TO_AGV, MANUAL_ACTIVE, MANUAL_PASSIVE
- 其他：TOTE_CONSOLIDATE_BY_STATION, INVENTORY_CHECK_BY_STATION, STAGE等

**StepType（步骤类型 - 原代码26种）**:
- 与TaskType基本对应，每种TaskType有对应的StepType

**CmdType（命令类型 - 原代码50+种）**:
- 基础：MOVE, ROTATE, TURN, PICK, PACK, TRANSPORT, REST, CHARGE
- 贴标机：AWAIT_BARCODE_SCAN, PRINT_READY, SEND_PRINT, CONFIRM_PRINT_FINISH
- 其他：CONTAINER_REPLENISHMENT, LIFT_UP, LIFT_DOWN, SYNC_MAP, PLACE, AFFIX_LABEL, ASSEMBLE, WRAPPING

**ActionType（动作类型 - 原代码30种）**:
- 入库类：CASE_INBOUND, REPLENISHMENT, CASE_REPLENISHMENT, CASE_RETURN, EMPTY_TOTE_INBOUND, PIECE_RECEIVING
- 出库类：PICK, PACK, STAGE, SORTING, EMPTY_TOTE_OUTBOUND, CASE_OUTBOUND, PICKING_WALL_PICK
- 加工类：PLACE, AFFIX_LABEL, ASSEMBLE, WRAPPING
- 搬运类：CHARGE, MOVEMENT, TRANSPORT, REQUEST_IDLE_ROBOT
- 盘点类：COUNT, RECOUNT, INVENTORY_CHECK

**参考**: design.md 第56节枚举对比检查

**facility-app 枚举**:
- [ ] ZoneType（STORAGE, PICKING, PACKING, SHIPPING, RECEIVING, BUFFER, SORTING）
- [ ] StationType（PICKING, PACKING, SHIPPING, RECEIVING, BUFFER, SORTING, WORKSTATION, ASRS_BUFFER, CONVEYOR_NODE）
- [ ] DeviceType（CONVEYOR, SORTER, PICK_WALL, SCANNER, PRINTER, SCALE, LIFT, PLC, AGV, AMR）
- [ ] DeviceStatus（ONLINE, OFFLINE, FAULT, MAINTENANCE）
- [ ] BindType（INPUT, OUTPUT, SCANNER, INDICATOR）
- [ ] PointType（STORAGE, PICK, DROP, LOCATION, STAGING, DOCK, STATION, PICKING_WALL, PICKING_WALL_BUFFER, FLOW_RACK等16种）
- [ ] LocationType（原代码16种：STORAGE, PICK, DROP, LOCATION, STAGING, DOCK, AUTOMATED_LOCATION, REWORK, SPOT, OFF_SITE, RMS, STATION, STATION_TYPE, PICKING_WALL, PICKING_WALL_BUFFER, FLOW_RACK）
- [ ] StationMode（CAR_REQUIRED, TOTE_LINE）- V1新增
- [ ] FacilityErrorCode 错误码枚举（6001-6999）
- [ ] FacilityException 异常类

**device-app 枚举**:
- [ ] MissionStatus（PENDING, DISPATCHED, IN_PROGRESS, COMPLETED, FAILED, CANCELLED）
- [ ] CallbackStatus（PENDING, SENT, SUCCESS, FAILED）
- [ ] CmdType（TRANSPORT, CASE_INBOUND, CASE_OUTBOUND, RETURN_TO_STORAGE, EMPTY_TOTE_INBOUND, EMPTY_TOTE_OUTBOUND, REQUEST_IDLE_ROBOT, RELEASE_AGV, CHARGING, PICK, COUNT, RECOUNT）
- [ ] CmdStatus（NEW, SENDING, ACCEPTED, IN_PROGRESS, EXCEPTION, PENDING, PAUSED, CLOSED, CANCELLED）
- [ ] CmdErrorType（TIMEOUT, CONNECTION_FAILED, INVALID_RESPONSE, DEVICE_FAULT, UNKNOWN）
- [ ] SchedulingMethod（AUTO, MANUAL, PRIORITY）
- [ ] ClientType（LIBIAO_AIR_ROB, LIBIAO_OPS, LIBIAO_OVERFLOW, HERMES_AGV, LANXIN_AGV, KEYENCE_BARCODE, OPTMV_BARCODE, YONGSUN_LABELER, YONGSUN_PRINTER, MOCK）
- [ ] EquipmentType（TOTE_CART, AIR_ROB, AGV, ELECTRONIC_LABEL, TRAFFIC_LIGHT, T_SORT, BARCODE_READER, LABELER, PRINTER, VISION_CAMERA, OPS）
- [ ] RobotStatus（IDLE, BUSY, CHARGING, OFFLINE, FAULT, MAINTENANCE）
- [ ] AirRobTaskType（TOTE_MOVEMENT, EMPTY_TOTE_OUTBOUND, REQUEST_IDLE_ROBOT, RELEASE_AGV）- RCS任务类型
- [ ] AirRobTaskEventType（START, FINISHED, FAILED, CANCELLED）- RCS任务事件
- [ ] OpsTaskReportType（PICK, PACK, REST, STAGE, PACK_STANDBY, REQUEST_IDLE_ROBOT）- OPS任务上报类型
- [ ] DeviceErrorCode 错误码枚举（7001-7999）
- [ ] DeviceException 异常类

**参考**: design.md 第 3.12 节「枚举定义」、第56节「枚举对比检查」

---

### 任务 1.2.3：补充遗漏枚举定义（原wcs-app完整迁移）（7h）

**目标**: 补充任务1.2.2中遗漏的枚举定义，确保原wcs-app 82个枚举完整迁移

> **[重要]** 经后端一致性检查（第408-418轮），发现约48个枚举在实体定义中被引用但未在枚举章节详细列出

**wcs-lite-app 补充枚举（约24个，3h）**:

**容器相关（2个）**:
- [ ] ContainerStatus（3值）：IDLE, OCCUPIED, FULL
- [ ] ContainerType（5值）：TOTE, PALLET, TOTE_CART, TOTE_RACK, BAG

**任务操作相关（3个）**:
- [ ] TaskOperationMode（4值）：MANUAL_ONLY, EQUIPMENT_ONLY, GOODS_TO_PERSON, MIXED_HUMAN_MACHINE
- [ ] AssignmentMode（3值）：MANUAL_ACTIVE, MANUAL_PASSIVE, EQUIPMENT
- [ ] TaskDestinationType（5值）：POINT_CODE, STATION_CODE, STATION_TYPE, LOCATION, ZONE_CODE

**消息相关（3个）**:
- [ ] MessageStatus（6值）：NEW, IN_PROGRESS, CLOSED, EXCEPTION, CANCELLED, FAILED
- [ ] MessageType（45+值）：STEP_CREATED, CONTAINER_ARRIVED_LOCATION, TASK_FINISHED, PICKING, PICKED, DROPPED, CONTAINER_REPLENISHMENT, CHANGE_LOCATION, JOB_SUBMIT, JOB_COMPLETED, COMMAND_COMPLETED, GIS, ASSIGN_CALLBACK, EMPTY_TOTE_OUTBOUND, EMPTY_TOTE_INBOUND, CASE_TOTE_INBOUND, RECEIPT_SEARCH, REQUEST_TOTE_TASK_RETRY, PICK_OUTBOUND, ORDER_SEARCH, DEPART_STATION, DISPATCH_TO_PACK, DISPATCH_TO_STAGE, CONSOLIDATE_SUBMIT, JOB_CLOSED, JOB_STARTED, INVENTORY_CHECK, ITEM_SEARCH, CONSOLIDATION_COMPLETE, EMPTY_TOTE_SEARCH, EXCEPTION_CONTAINER_LOCATION_CHANGE, TASK_CANCELLED, MARK_CONTAINER_FULL, PICKING_CHECK, NEXT_CONTAINER_LOCATION, TOTE_SPLIT_SUBMIT, TOTE_FILLRATE, LOCATION_BATCH_UPDATE, INVENTORY_SEARCH, LOCATION_STATUS_BATCH_UPDATE, REQUEST_TOTES, BATCH_CHANGE_LOCATION, REPORT_ISSUE, BATCH_JOB_SUBMIT, JOB_TRIGGER_CREATE
- [ ] MessageSubscriber（3值）：UNIS_WMS, LIBIAO_WES, UNIS_WISE

**执行相关（2个）**:
- [ ] ExecutionStatus（22值）：WAITING, TO_CONTAINER_REPLENISHMENT, AT_CONTAINER_REPLENISHMENT, CONTAINER_REPLENISHING, CONTAINER_REPLENISHED, TO_PICK_POINT, AT_PICK_POINT, PICKING, PICKED, TO_DROP_POINT, AT_DROP_POINT, DROPPING, DROPPED, TO_CHARGE_POINT, AT_CHARGE_POINT, CHARGING, CHARGED, MOVING, MOVED, PRINTING, PRINTED
- [ ] ExecutionMethod（2值）：WEB_HOOK, EXECUTE_FUNCTION

**Job相关（2个）**:
- [ ] JobGroupingAttribute（14值）：WAVE_NO, ORDER_ID, BATCH_NO, JOB_ID, PO_NO, CONTAINER_CODE, TO_LOCATION_NAME, BUSINESS_ID, TO_CONTAINER_CODE, CUSTOMER_ID, ORDER_TYPE, ACTION_TYPE, FROM_LOCATION_TYPE, TO_LOCATION_TYPE
- [ ] JobHistoryOperationType（5值）：ASSIGN, SUBMIT, CANCELLED, INVENTORY_DISCREPANCY, QUANTITY_DISCREPANCY

**业务相关（7个）**:
- [ ] PickMethod（4值）：WAVE_PICK_BY_ITEM, WAVE_PICK_BY_ORDER, BATCH_ORDER_PICK, ORDER_PICK
- [ ] PickType（3值）：PIECE_PICK, CASE_PICK, PALLET_PICK
- [ ] InventoryCountMode（2值）：OPEN, BLIND
- [ ] IssueType（5值）：LOCATION_ISSUE, ITEM_NOT_FOUND, ITEM_QTY_SHORTAGE, ITEM_DAMAGE, TOTE_FULL
- [ ] OrderType（11值）：NORMAL_STORE_FOLLOWUP, NORMAL_EC_CUSTOMER_ORDER, EMERGENCY_PICK, STORE_PICKUP_SINGLE, OMNI_CHANNEL, NORMAL_SINGLE, PURCHASE_ALLOCATION, MANUAL_OUTBOUND_BY_TOTE, MANUAL_OUTBOUND_BY_SKU, AIR_ROB_RACKS_SHIPPING, AIR_ROB_FLOOR_SHIPPING
- [ ] TargetType（6值）：CONTAINER_REPLENISHMENT, PICK, CONTAINER_DROP, PACK, CHARGING, MOVE
- [ ] ResetType（4值）：LOCATION, STATION, EQUIPMENT, EMPTIED

**命令消息相关（2个）**:
- [ ] CommandMessageStatus（2值）：SUCCESS, FAILED
- [ ] CommandMessageType（2值）：DEVICE, WEBSOCKET

**运行状态（1个）**:
- [ ] RunningStatus（3值）：RUNNING, PAUSED, STOPPED

**device-app 补充枚举（约20个，3h）**:

**Equipment相关（11个）**:
- [ ] EquipmentStatus（5值）：IDLE, CHARGING, WORKING, FAULT, OFFLINE
- [ ] EquipmentWorkMode（7值）：MANUAL_HANDLING, LIFT, ROLLER, CLAMP, FORKLIFT, PICK_TO_LIGHT, BARCODE_READER
- [ ] EquipmentMoveMode（2值）：AUTONOMOUS_WALK, ROUTE_NAVIGATION
- [ ] EquipmentControlAuthority（2值）：SYSTEM, MANUAL
- [ ] EquipmentBindingType（5值）：LOCATION_BINDING, CONTAINER_BINDING, ZONE_BINDING, STATION_BINDING, AISLE_BINDING
- [ ] EquipmentManufacturer（7值）：ITEM, SLAMTEC, LIBIAO, LANXIN, YOUNG_SUN, OPT_MV, KEYENCE
- [ ] EquipmentBehaviorResultEnum（20+值）：FINISHED, STEP_SELECTION, STEP_UNBINDING, GENERATE_PRE_COMMAND, DISPATCH_TO_CHARGE, DISPATCH_END_CHARGE, DISPATCH_DROP, DISPATCH_TO_PICKUP, DISPATCH_PICKUP, DISPATCH_ADJUST_HEAD, TARGET_SELECTION, DISPATCH_TO_TARGET_POSITION, DISPATCH_TO_CONTAINER_REPLENISHMENT_STATION, DISPATCH_CONTAINER_REPLENISHMENT, SWITCH_FACE_POINT_SELECTION, DISPATCH_TO_FACE_POINT, DISPATCH_SWITCH_FACE, TASK_STEP_DECISION
- [ ] EquipmentBehaviorStepEnum（16值）：DISPATCH_CHECK, IN_PROGRESS_STEP_CHECK, IN_PROGRESS_COMMAND_CHECK, CHARGE_COMMAND_CHECK, COMPLETION_CONDITION_CHECK, PICKUP_COMPLETION_CHECK, EMPTY_CONTAINER_CHECK, ARRIVE_REPLENISH_STATION_CHECK, ARRIVE_PICKUP_POINT_CHECK, ARRIVE_TARGET_POSITION_CHECK, NEED_DROP_CHECK, NEED_ADJUST_HEAD_CHECK, NEED_CHARGING_CHECK, NEED_SWITCH_INTERFACE_CHECK, SWITCH_POINT_SELECTION_CHECK, ARRIVE_SWITCH_POINT_CHECK
- [ ] EquipmentStateCheckStepEnum（7值）：ONLINE_CHECK, HEARTBEAT_CHECK, FAULT_CHECK, SYNC_MAP_CHECK, BLOCKED_CHECK, TIMEOUT_CHECK, NORMAL_CHECK
- [ ] EquipmentStateResultEnum（7值）：REGISTRATION, OFFLINE, FAULT, COMMAND_TIMEOUT, BLOCKED, NORMAL, SYNC_MAP
- [ ] EquipmentExceptionSourceType（3值）：FIRE_ALARM, RCS_E_STOP, RCS_SYSTEM_REPORT

**AirRob相关（4个）**:
- [ ] AirRobEStopStatus（2值）：E_STOP, FIRE_ALARM
- [ ] AirRobSystemSource（4值）：UI, ROBOT, WES, DEVICE
- [ ] AirRobSystemStatus（2值）：RUNNING, STOP
- [ ] AirRobToteEventType（3值）：TAKEN, PUT, PLACED_ON

**OPS相关（4个）**:
- [ ] OpsSystemReportSource（5值）：UI, ROBOT, WES, AUTO, DEVICE
- [ ] OpsSystemReportStatus（3值）：RUNNING, STOP, ESTOP
- [ ] OpsTaskReportResult（4值）：START, FINISHED, FAILED, CANCELLED
- [ ] OpsToteReportStatus（2值）：TAKEN, PUT

**贴标机相关（3个）**:
- [ ] LbActiveMode（2值）：MANUAL, AUTOMATIC
- [ ] LbBillInType（3值）：LOOSE_PARTS, FULL_BOX, EMPTY_BOX
- [ ] LbBillOutType - 待确认

**其他（1个）**:
- [ ] Protocol（7值）：HTTP, HTTPS, TCP, WS, WSS, MODBUS_TCP, GRPC

**facility-app 补充枚举（约4个，1h）**:

**地图相关（2个）**:
- [ ] MapMappingRelationType（5值）：ZONE_WITH_LOCATION, POINT_WITH_LOCATION, ZONE_WITH_POINT, USER_WATCHED_AISLES, AIR_ROB_LOCATION_MAPPING
- [ ] MapPathType（4值）：LINE, DOCKING, ARC, BEZIER

**位置相关（1个）**:
- [ ] LocationStatus（4值）：EMPTY, OCCUPIED, FULL, RESERVED

**参考**: 原wcs-app/domain/common/enums目录（82个枚举类）

---

### 任务 1.3：数据库表创建（4h）

**目标**: 创建三个模块的所有数据库表

**交付物**:

**wcs-lite-app 数据库表**（SQL 脚本，6张表）:
- [ ] event_job 表（作业表）
- [ ] event_task 表（任务表，包含 version 字段用于乐观锁）
- [ ] event_step 表（步骤表）
- [ ] event_command 表（命令表）
- [ ] def_container_info 表（容器定义表）
- [ ] def_strategy_configuration 表（策略配置表）

**device-app 数据库表**（SQL 脚本，5张表）:
- [ ] def_robot 表（机器人定义表）
- [ ] def_traffic_light 表（信号灯定义表）
- [ ] def_rcs_vendor 表（RCS 厂商配置表）
- [ ] event_rcs_mission 表（RCS 任务表）
- [ ] doc_callback_log 表（回调日志表，WAL 原则）

**facility-app 数据库表**（SQL 脚本，9张表）:
- [ ] def_map_info 表（地图定义表）
- [ ] def_map_point 表（点位定义表）
- [ ] def_map_location 表（位置定义表）
- [ ] def_map_version 表（地图版本表）
- [ ] def_map_path 表（地图路径表）
- [ ] def_map_zone 表（区域定义表）
- [ ] def_map_mapping_relation 表（地图映射关系表）
- [ ] def_station 表（工作站定义表）
- [ ] def_container_spec 表（容器规格定义表）

**[重要]** 所有表都需要包含：
- tenantId（租户ID，NOT NULL）
- isolationId（隔离ID）
- createdTime, createdBy, updatedTime, updatedBy（审计字段）

**参考**: design.md 第七章「数据库设计」、第59节「模块归属总结」、第61节「数据库表名规范」

---

### 任务 1.4：wcs-lite-app 领域实体（8h）

**目标**: 实现 wcs-lite-app 的核心业务实体

**交付物**:

**Job 实体（原wcs-app约90+字段，完整迁移）**:

基础字段：
- [ ] id, taskId, status, businessActionId, businessId
- [ ] orderId, poNo, slotCode, priority, isDeleted

动作类型字段：
- [ ] actionType, nextActionType, actionMode
- [ ] pickMethod, pickType

站点/位置字段：
- [ ] toStationCode, stationCode
- [ ] fromLocationName, fromLocationId, fromZoneCode, fromLocationType
- [ ] toLocationId, toLocationName, toLocationType

物料字段：
- [ ] itemId, itemCode, itemModel, itemName, itemDescription, itemShortDescription
- [ ] uomId, qty, completedQty, issueQty, issueType
- [ ] itemBoxQty, itemCsQty
- [ ] lotNo, batchNo, abbreviation
- [ ] upcCode, upcCodeCase, eanCode

容器字段：
- [ ] containerCode, toContainerCode
- [ ] fromLPId, fromLPIds（JSON数组）

执行状态字段：
- [ ] executionStatus, assignmentMode, operationMode
- [ ] isTaskAction, isSecondaryJob

分配字段：
- [ ] assigneeUserId, assigneeEquipmentCode, operatedBy
- [ ] startTime, endTime, dueTime

WMS集成字段：
- [ ] wmsTaskType, requiredCapabilities（JSON数组）, dependentWmsActionIds（JSON数组）
- [ ] parentWmsActionId, wmsGroupId, equipmentType
- [ ] palletCount

扩展字段：
- [ ] dynTxtValue01 ~ dynTxtValue15（15个动态文本字段）
- [ ] extensionJson（JSON扩展）
- [ ] interfaceMessage（接口消息JSON）
- [ ] exceptionMessage（异常消息）

其他业务字段：
- [ ] customerId, orderType, waveNo
- [ ] titleId, goodsType, isInternalLocation, priorityPoints
- [ ] itemDisallowToMixItemOnSameLP

业务方法：
- [ ] start(), complete(), fail(errorMessage), cancel(), isTerminated()

注解与继承：
- [ ] @TableName(value = "event_job", autoResultMap = true)
- [ ] extends BaseCompanyEntity

**Task 实体（原wcs-app完整字段）**:

基础字段：
- [ ] id, businessId, businessType, taskType, status
- [ ] priority, isDeleted

设备字段：
- [ ] equipmentCode, equipmentModelCode, equipmentHeading
- [ ] isEquipmentLock, lockDuration

站点字段：
- [ ] stationCode

容器字段：
- [ ] containerSpecCode, containerCodes（JSON数组）
- [ ] containerHeading, isContainerDrop

目的地字段：
- [ ] destinationType, destination
- [ ] fromMapCode, toMapCode

操作模式字段：
- [ ] operationMode

异常字段：
- [ ] exceptionMessage

领取字段：
- [ ] claimTime

其他字段：
- [ ] batchNo, priorityPoints

乐观锁：
- [ ] version（@Version 注解）

业务方法：
- [ ] dispatch(deviceId, externalTaskId), start(), complete(), fail(errorMessage), isTerminated()

注解与继承：
- [ ] @TableName(value = "event_task", autoResultMap = true)
- [ ] extends BaseCompanyEntity

**WorkflowDefinition 实体**:
- [ ] 字段：definitionId, workflowCode, workflowName, description, jobType, isActive, version
- [ ] Flowable 定义：processDefinitionKey（BPMN 流程定义 key）
- [ ] 节点配置：nodeConfigs（List<NodeConfig> JSON）
- [ ] 值对象：NodeConfig（nodeId, nodeType, nodeName, params）
- [ ] 注解：@TableName(value = "def_workflow_definition", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**WorkflowInstance 实体**:
- [ ] 字段：instanceId, definitionId, jobId, status, currentNodeId
- [ ] 执行上下文：context（JSON）
- [ ] 节点执行记录：nodeExecutions（List<NodeExecution> JSON）
- [ ] 时间字段：startTime, endTime
- [ ] 异常字段：errorMessage
- [ ] 值对象：NodeExecution（nodeId, nodeName, nodeType, status, startTime, endTime, errorMessage, taskId）
- [ ] 业务方法：updateNodeExecution()
- [ ] 注解：@TableName(value = "doc_workflow_instance", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**Repository 接口与实现**:
- [ ] JobRepository + JobRepositoryImpl
- [ ] TaskRepository + TaskRepositoryImpl（包含 updateWithVersion 方法）
- [ ] WorkflowDefinitionRepository + WorkflowDefinitionRepositoryImpl
- [ ] WorkflowInstanceRepository + WorkflowInstanceRepositoryImpl

**参考**: design.md 第 3.1-3.4 节

---

### 任务 1.4.1：Step 实体（原wcs-app完整迁移）（2h）

**目标**: 实现 Step 步骤实体，管理任务执行的具体步骤

**Step 实体（16字段）**:

基础字段：
- [ ] id - 主键
- [ ] taskIds - 关联任务ID列表（@JsonTableField List<String>）
- [ ] stepType - 步骤类型（StepType枚举）
- [ ] status - 步骤状态（StepStatus枚举）

设备字段：
- [ ] equipmentCode - 设备编码
- [ ] equipmentModelCode - 设备型号编码

位置字段：
- [ ] mapCode - 地图编码
- [ ] fromPointCode - 起始点位编码
- [ ] transportPointCode - 中转点位编码
- [ ] toPointCode - 目标点位编码
- [ ] toLocationName - 目标位置名称

关联字段：
- [ ] jobIds - 关联作业ID列表（@JsonTableField List<String>）

执行字段：
- [ ] exceptionMessage - 异常消息
- [ ] schedulingMethod - 调度方式（SchedulingMethod枚举）
- [ ] operationMode - 操作模式（TaskOperationMode枚举）
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "event_step", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] StepRepository + StepRepositoryImpl
- [ ] StepMapper

---

### 任务 1.4.2：Command 实体（原wcs-app完整迁移）（3h）

**目标**: 实现 Command 命令实体，管理与外部设备的通信命令

**Command 实体（26字段）**:

基础字段：
- [ ] id - 主键
- [ ] masterCmdId - 主指令ID（云票整合场景，主指令=自身id，从属指令=主指令id，独立指令=NULL）
- [ ] externalCmdCode - 外部命令编码
- [ ] taskIds - 关联任务ID列表（@JsonTableField List<String>）
- [ ] stepIds - 关联步骤ID列表（@JsonTableField List<String>）
- [ ] jobIds - 关联作业ID列表（@JsonTableField List<String>）

命令类型字段：
- [ ] cmdType - 命令类型（CmdType枚举）
- [ ] status - 命令状态（CmdStatus枚举）
- [ ] errorType - 错误类型（CmdErrorType枚举）

设备字段：
- [ ] equipmentCode - 设备编码
- [ ] stationCode - 工作站代码
- [ ] equipmentModelCode - 设备型号编码

调度字段：
- [ ] schedulingMethod - 调度方式（SchedulingMethod枚举）
- [ ] assignmentMode - 分配模式（AssignmentMode枚举）
- [ ] operationMode - 操作模式（TaskOperationMode枚举）

位置字段：
- [ ] containerCode - 容器编码
- [ ] mapCode - 地图编码
- [ ] fromPointCode - 起始点位编码
- [ ] toPointCode - 目标点位编码
- [ ] toLocationName - 目标位置名称

内容字段：
- [ ] content - 命令内容
- [ ] exceptionMessage - 异常消息

状态字段：
- [ ] isExternalConfirmed - 是否外部确认
- [ ] isDeleted - 是否删除

时间字段：
- [ ] closeTime - 关闭时间
- [ ] startTime - 开始时间

注解与继承：
- [ ] @TableName(value = "event_command", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] CommandRepository + CommandRepositoryImpl
- [ ] CommandMapper

---

### 任务 1.4.3：Container 实体（原wcs-app完整迁移）（2h）

**目标**: 实现 Container 容器实体，管理料箱/托盘等容器

**Container 实体（15字段）**:

基础字段：
- [ ] id - 主键（Long类型）
- [ ] containerType - 容器类型（ContainerType枚举）
- [ ] containerSpecCode - 容器规格编码
- [ ] containerCode - 容器编码
- [ ] status - 容器状态（ContainerStatus枚举）

位置字段：
- [ ] locationName - 位置名称
- [ ] reservedLocationName - 预留位置名称
- [ ] stationCode - 工作站编码
- [ ] equipmentCode - 设备编码
- [ ] pointCode - 点位编码
- [ ] mapCode - 地图编码

关联字段：
- [ ] lpId - LP ID

状态字段：
- [ ] isEnabled - 是否启用
- [ ] isDeleted - 是否删除

扩展字段：
- [ ] dataExt - 扩展数据（@JsonTableField List<ContainerDataInfo>）

值对象：
- [ ] ContainerDataInfo - 容器扩展数据值对象

注解与继承：
- [ ] @TableName(value = "def_container_info", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] ContainerRepository + ContainerRepositoryImpl
- [ ] ContainerMapper

---

### 任务 1.4.4：StrategyConfiguration 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 StrategyConfiguration 策略配置实体，管理调度策略

**StrategyConfiguration 实体（7字段）**:

基础字段：
- [ ] id - 主键（Long类型）
- [ ] strategyType - 策略类型（StrategyType枚举）
- [ ] strategyCode - 策略编码
- [ ] strategyDescription - 策略描述

配置字段：
- [ ] strategyContent - 策略内容（@JsonTableField StrategyContent）
- [ ] strategyMapping - 策略映射（@JsonTableField StrategyMapping）

状态字段：
- [ ] isEnabled - 是否启用

值对象：
- [ ] StrategyContent - 策略内容值对象
- [ ] StrategyMapping - 策略映射值对象

注解与继承：
- [ ] @TableName(value = "def_strategy_configuration", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] StrategyConfigurationRepository + StrategyConfigurationRepositoryImpl
- [ ] StrategyConfigurationMapper

---

### 任务 1.5：device-app 领域实体（4h）

**目标**: 实现 device-app 的 RCS 相关实体

**交付物**:

**RcsVendorConfig 实体**:
- [ ] 字段：vendorId, vendorCode, vendorName, vendorType
- [ ] 配置字段：baseUrl, authConfig（JSON）, stationMapping（JSON）, capabilities（JSON）
- [ ] 状态字段：status（ENABLED/DISABLED）, isActive
- [ ] 注解：@TableName(value = "def_rcs_vendor_config", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**RcsMission 实体**（RCS 任务）:
- [ ] 字段：missionId, taskId（wcs-lite-app 的 Task ID）, vendorCode
- [ ] 任务字段：fromStation, toStation, containerId, priority
- [ ] 外部任务：externalMissionId（RCS 厂商返回的任务ID）
- [ ] 状态字段：status
- [ ] 回调字段：callbackUrl
- [ ] 时间字段：dispatchTime, startTime, endTime
- [ ] 异常字段：errorMessage
- [ ] 注解：@TableName(value = "doc_rcs_mission", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**CallbackLog 实体**（回调日志，WAL 原则）:
- [ ] 字段：id, taskId, missionId, callbackUrl, status
- [ ] 内容字段：requestBody, responseBody, errorMessage
- [ ] 重试字段：retryCount, nextRetryTime
- [ ] 注解：@TableName(value = "doc_device_callback_log", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**Repository 接口与实现**:
- [ ] RcsVendorConfigRepository + RcsVendorConfigRepositoryImpl
- [ ] RcsMissionRepository + RcsMissionRepositoryImpl
- [ ] CallbackLogRepository + CallbackLogRepositoryImpl

---

### 任务 1.5.1：Robot 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 Robot 机器人实体，管理机器人状态和位置

**Robot 实体（11字段）**:

基础字段：
- [ ] id - 主键
- [ ] robotNo - 机器人编号
- [ ] status - 机器人状态（RobotStatus枚举）

位置字段：
- [ ] gridX - 网格X坐标
- [ ] gridY - 网格Y坐标
- [ ] targetGridX - 目标网格X坐标
- [ ] targetGridY - 目标网格Y坐标

状态字段：
- [ ] voltage - 电压
- [ ] batteryLevel - 电池电量
- [ ] task - 当前任务
- [ ] error - 错误信息

注解与继承：
- [ ] @TableName(value = "def_robot", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] RobotRepository + RobotRepositoryImpl
- [ ] RobotMapper

---

### 任务 1.5.2：TrafficLight 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 TrafficLight 信号灯实体，管理电子标签/信号灯状态

**TrafficLight 实体（15字段）**:

基础字段：
- [ ] id - 主键
- [ ] equipmentCode - 设备编码
- [ ] lightId - 灯ID

绑定字段：
- [ ] bindingType - 绑定类型
- [ ] locationId - 位置ID
- [ ] zoneCode - 区域编码
- [ ] stationCode - 工作站编码
- [ ] aisle - 通道

容器字段：
- [ ] containerCode - 容器编码
- [ ] containerBin - 容器格口

灯光字段：
- [ ] color - 颜色
- [ ] blinkMode - 闪烁模式

蜂鸣器字段：
- [ ] isBuzzerEnabled - 是否启用蜂鸣器
- [ ] buzzerMode - 蜂鸣器模式

状态字段：
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "def_traffic_light", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] TrafficLightRepository + TrafficLightRepositoryImpl
- [ ] TrafficLightMapper

---

### 任务 1.6：facility-app 领域实体（4h）

**目标**: 实现 facility-app 的资源管理实体

**交付物**:

**Zone 实体**:
- [ ] 字段：zoneId, zoneCode, zoneName, zoneType, warehouseCode, description, isActive
- [ ] 注解：@TableName(value = "def_zone", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**Station 实体**:
- [ ] 字段：stationId, stationCode, stationName, stationType, zoneId, isActive
- [ ] 注解：@TableName(value = "def_station", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**Device 实体**:
- [ ] 字段：deviceId, deviceCode, deviceName, deviceType, vendorCode, stationId, zoneId
- [ ] 状态字段：status, ipAddress, port
- [ ] 扩展字段：capabilities（JSON）, config（JSON）
- [ ] 启用字段：isActive
- [ ] 注解：@TableName(value = "def_device", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**StationDevice 实体**（站点设备绑定）:
- [ ] 字段：id, stationId, deviceId, bindType, sequence
- [ ] 注解：@TableName(value = "def_station_device", autoResultMap = true)
- [ ] 继承：extends BaseCompanyEntity

**Repository 接口与实现**:
- [ ] ZoneRepository + ZoneRepositoryImpl
- [ ] StationRepository + StationRepositoryImpl
- [ ] DeviceRepository + DeviceRepositoryImpl
- [ ] StationDeviceRepository + StationDeviceRepositoryImpl

---

### 任务 1.6.1：Point 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 Point 点位实体，管理地图点位信息

**Point 实体（10字段）**:

基础字段：
- [ ] id - 主键
- [ ] mapCode - 地图编码
- [ ] pointCode - 点位编码
- [ ] externalCode - 外部编码

坐标字段：
- [ ] x - X坐标
- [ ] y - Y坐标
- [ ] z - Z坐标
- [ ] yaw - 偏航角

状态字段：
- [ ] isEnabled - 是否启用
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "def_map_point", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] PointRepository + PointRepositoryImpl
- [ ] PointMapper

---

### 任务 1.6.2：Map 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 Map 地图实体，管理地图基本信息

**Map 实体（8字段）**:

基础字段：
- [ ] id - 主键
- [ ] mapCode - 地图编码
- [ ] version - 版本

设备字段：
- [ ] equipmentType - 设备类型（EquipmentType枚举）
- [ ] equipmentModelCode - 设备型号编码

路径字段：
- [ ] mapPath - 地图路径
- [ ] transformInfo - 转换信息

状态字段：
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "def_map_info", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] MapRepository + MapRepositoryImpl
- [ ] MapMapper

---

### 任务 1.6.3：MapLocation 实体（原wcs-app完整迁移）（2h）

**目标**: 实现 MapLocation 位置实体，管理地图位置详细信息

**MapLocation 实体（19字段）**:

基础字段：
- [ ] id - 主键
- [ ] wmsLocationId - WMS位置ID
- [ ] name - 名称
- [ ] type - 类型（LocationType枚举）
- [ ] status - 状态

容器字段：
- [ ] containerCode - 容器编码
- [ ] maxSize - 最大容量

位置字段：
- [ ] tag - 标签
- [ ] aisle - 通道
- [ ] bay - 货架
- [ ] level - 层
- [ ] slot - 槽位
- [ ] hlpId - HLP ID

尺寸字段：
- [ ] length - 长度
- [ ] width - 宽度
- [ ] height - 高度
- [ ] coordinate - 坐标

状态字段：
- [ ] isEnabled - 是否启用
- [ ] deviceStatus - 设备状态

注解与继承：
- [ ] @TableName(value = "def_map_location", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] MapLocationRepository + MapLocationRepositoryImpl
- [ ] MapLocationMapper

---

### 任务 1.6.4：MapVersion 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 MapVersion 地图版本实体，管理地图版本历史

**MapVersion 实体（7字段）**:

基础字段：
- [ ] id - 主键
- [ ] mapCode - 地图编码
- [ ] version - 版本号

文件字段：
- [ ] fileName - 文件名
- [ ] fileContent - 文件内容
- [ ] fileSize - 文件大小

状态字段：
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "def_map_version", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] MapVersionRepository + MapVersionRepositoryImpl
- [ ] MapVersionMapper

---

### 任务 1.6.5：MapPath 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 MapPath 地图路径实体，管理点位之间的路径信息

**MapPath 实体（11字段）**:

基础字段：
- [ ] id - 主键
- [ ] mapCode - 地图编码
- [ ] pathType - 路径类型

点位字段：
- [ ] fromPointCode - 起始点位编码
- [ ] toPointCode - 目标点位编码

限制字段：
- [ ] widthLimit - 宽度限制
- [ ] heightLimit - 高度限制
- [ ] speedLimit - 速度限制

通行字段：
- [ ] isCargoPassable - 是否可载货通过

状态字段：
- [ ] isEnabled - 是否启用
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "def_map_path", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] MapPathRepository + MapPathRepositoryImpl
- [ ] MapPathMapper

---

### 任务 1.6.6：MapMappingRelation 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 MapMappingRelation 地图映射关系实体，管理实体之间的映射关系

**MapMappingRelation 实体（6字段）**:

基础字段：
- [ ] id - 主键
- [ ] relationType - 关系类型

实体字段：
- [ ] masterEntity - 主实体
- [ ] dependentEntities - 依赖实体

状态字段：
- [ ] isEnabled - 是否启用
- [ ] isDeleted - 是否删除

注解与继承：
- [ ] @TableName(value = "def_map_mapping_relation", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] MapMappingRelationRepository + MapMappingRelationRepositoryImpl
- [ ] MapMappingRelationMapper

---

### 任务 1.6.7：ContainerSpec 实体（原wcs-app完整迁移）（1h）

**目标**: 实现 ContainerSpec 容器规格实体，管理容器规格定义

**ContainerSpec 实体（9字段）**:

基础字段：
- [ ] containerSpecId - 主键（String类型）
- [ ] containerSpecCode - 规格编码（业务唯一键）
- [ ] containerSpecName - 规格名称
- [ ] containerType - 容器类型（ContainerType枚举）

尺寸字段：
- [ ] length - 长度(mm)
- [ ] width - 宽度(mm)
- [ ] height - 高度(mm)
- [ ] maxWeight - 最大承重(kg)

条码字段：
- [ ] barcodePrefixes - 条码前缀列表（@JsonTableField List<String>）

注解与继承：
- [ ] @TableName(value = "def_container_spec", autoResultMap = true)
- [ ] @FacilityIsolation
- [ ] extends BaseFacilityEntity

**Repository**:
- [ ] ContainerSpecRepository + ContainerSpecRepositoryImpl
- [ ] ContainerSpecMapper

---

### 任务 1.7：Mapper 接口与单元测试（8h）

**目标**: 创建 MyBatis-Plus Mapper 接口并编写单元测试

**交付物**:

**wcs-lite-app Mapper**:
- [ ] JobMapper
- [ ] TaskMapper
- [ ] WorkflowDefinitionMapper
- [ ] WorkflowInstanceMapper

**facility-app Mapper**:
- [ ] ZoneMapper
- [ ] StationMapper
- [ ] DeviceMapper
- [ ] StationDeviceMapper

**device-app Mapper**:
- [ ] RcsVendorConfigMapper
- [ ] RcsMissionMapper
- [ ] CallbackLogMapper

**单元测试**:
- [ ] Job 实体业务方法测试（状态流转）
- [ ] Task 实体业务方法测试（状态流转、乐观锁）
- [ ] WorkflowInstance 业务方法测试
- [ ] Repository CRUD 测试（三个模块）

---

## 验收标准

1. 三个模块都能正常编译启动
2. wcs-lite-app 数据库表正确创建（6 张表：event_job, event_task, event_step, event_command, def_container_info, def_strategy_configuration）
3. device-app 数据库表正确创建（5 张表：def_robot, def_traffic_light, def_rcs_vendor, event_rcs_mission, doc_callback_log）
4. facility-app 数据库表正确创建（9 张表：def_map_info, def_map_point, def_map_location, def_map_version, def_map_path, def_map_zone, def_map_mapping_relation, def_station, def_container_spec）
5. 所有实体类继承 BaseCompanyEntity
6. 所有实体类的业务方法有单元测试覆盖
7. Repository 能正常进行 CRUD 操作
8. 代码符合项目编码规范

---

## 注意事项

- 时间字段使用 `TimeZones.now()` 而非 `LocalDateTime.now()`
- 异常使用 `WcsException/DeviceException` + 错误码枚举，禁止硬编码错误消息
- 实体类 @TableName 必须包含 `autoResultMap = true`
- 所有实体继承 `BaseCompanyEntity`（包含 tenantId, isolationId）
- 遵循 DDD 充血模型，业务逻辑放在实体中
- 表名前缀规范：def_（定义表）、doc_（业务单据表）、event_（事件表）
