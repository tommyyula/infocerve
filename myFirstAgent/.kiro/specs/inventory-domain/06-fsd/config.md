# 动态属性配置 FSD

## 1. 功能概述

### 1.1 功能目标

提供动态属性映射的配置管理功能，支持将库存表的通用动态字段映射为业务可读名称，是系统灵活性和可配置性的基础模块。

### 1.2 关联用户故事

- US-CFG-001：动态属性映射配置
- US-CFG-002：自定义字段显示配置
- US-CFG-003：序列号管理

### 1.3 关联需求项

- FR-CFG-001：动态属性映射配置
- FR-CFG-002：自定义字段显示配置
- FR-CFG-003：序列号管理

---

## 2. 用户场景

### 场景 1：查询动态属性映射

角色：系统管理员
前置条件：用户已登录，有配置管理权限
操作流程：
1. 用户进入动态属性映射页面
2. 用户输入查询条件（映射类型、业务名称等）
3. 用户点击"查询"按钮
4. 系统调用 API 查询映射配置
5. 系统显示查询结果列表

预期结果：显示符合条件的映射配置记录

### 场景 2：创建动态属性映射

角色：系统管理员
前置条件：用户已登录，有配置管理权限
操作流程：
1. 用户点击"新建映射"按钮
2. 系统弹出创建表单
3. 用户选择映射类型、原始字段，输入业务名称
4. 用户点击"确定"按钮
5. 系统调用 API 创建映射
6. 系统显示创建成功提示

预期结果：映射配置创建成功

### 场景 3：编辑动态属性映射

角色：系统管理员
前置条件：映射配置存在
操作流程：
1. 用户点击某条映射记录的"编辑"按钮
2. 系统弹出编辑表单，回填当前数据
3. 用户修改业务名称
4. 用户点击"确定"按钮
5. 系统调用 API 更新映射
6. 系统显示更新成功提示

预期结果：映射配置更新成功

### 场景 4：删除动态属性映射

角色：系统管理员
前置条件：映射配置存在
操作流程：
1. 用户点击某条映射记录的"删除"按钮
2. 系统弹出确认对话框
3. 用户确认删除
4. 系统调用 API 删除映射
5. 系统显示删除成功提示

预期结果：映射配置删除成功

---

## 3. 界面说明

### 3.1 页面布局

对应 Demo：05-demo/index.html#dyn-property-mapping

页面分为两个区域：
- 查询区域：顶部卡片，包含查询表单和操作按钮
- 结果区域：底部卡片，显示映射配置列表表格

### 3.2 页面区域

区域 A：查询表单
- 位置：页面顶部卡片
- 功能：输入查询条件
- 包含元素：
  - 第一行：Type（下拉）、Custom Field（输入）、Original Field（下拉）
  - 按钮组：查询、重置、新建映射

区域 B：映射配置列表表格
- 位置：结果卡片内容区
- 功能：显示映射配置列表
- 包含列：ID、Type、Custom Field、Original Field、Created Time、操作

---

## 4. 交互逻辑

### 4.1 页面加载

触发时机：页面首次加载
处理逻辑：
1. 初始化查询表单，所有字段为空
2. 自动查询所有映射配置
3. 显示结果列表

### 4.2 查询映射

触发时机：用户点击"查询"按钮
处理逻辑：
1. 收集表单中的查询条件
2. 调用 API：GET /api/dynproperty-mapping
3. 显示 loading 状态
4. 成功后渲染结果表格
5. 失败后显示错误提示

### 4.3 新建映射

触发时机：用户点击"新建映射"按钮
处理逻辑：
1. 弹出创建表单弹窗
2. 用户选择映射类型（INVENTORY/LOCATION）
3. 用户选择原始字段（dyn_txt_property_value_01 等）
4. 用户输入业务名称
5. 用户点击"确定"
6. 调用 API：POST /api/dynproperty-mapping
7. 成功后关闭弹窗，刷新列表

### 4.4 编辑映射

触发时机：用户点击"编辑"按钮
处理逻辑：
1. 弹出编辑表单弹窗，回填当前数据
2. 用户修改业务名称
3. 用户点击"确定"
4. 调用 API：PUT /api/dynproperty-mapping/{id}
5. 成功后关闭弹窗，刷新列表

### 4.5 删除映射

触发时机：用户点击"删除"按钮
处理逻辑：
1. 弹出确认对话框
2. 用户确认后调用 API：DELETE /api/dynproperty-mapping/{id}
3. 成功后刷新列表
4. 失败后显示错误提示

---

## 5. 数据字段

### 5.1 查询表单字段

字段名：Type
- 字段标识：type
- 控件类型：select
- 数据类型：enum
- 是否必填：否
- 枚举值：INVENTORY、LOCATION

字段名：Custom Field
- 字段标识：customField
- 控件类型：input
- 数据类型：string
- 是否必填：否

字段名：Original Field
- 字段标识：originalField
- 控件类型：select
- 数据类型：string
- 是否必填：否

### 5.2 列表字段

字段名：ID
- 字段标识：id
- 数据类型：number
- 显示格式：原样显示

字段名：Type
- 字段标识：type
- 数据类型：enum
- 显示格式：Tag 标签

字段名：Custom Field
- 字段标识：customField
- 数据类型：string
- 显示格式：原样显示

字段名：Original Field
- 字段标识：originalField
- 数据类型：string
- 显示格式：原样显示

字段名：Created Time
- 字段标识：createdTime
- 数据类型：datetime
- 显示格式：YYYY-MM-DD HH:mm

### 5.3 枚举定义

枚举名：DynPropertyType
- INVENTORY：库存属性
- LOCATION：库位属性

---

## 6. 业务规则

### 6.1 创建规则

BR-CFG-001：唯一性校验
- 触发条件：创建映射
- 处理逻辑：同一租户下，同一类型的原始字段只能映射一次
- 影响范围：创建操作

BR-CFG-002：业务名称唯一
- 触发条件：创建/更新映射
- 处理逻辑：同一租户下，业务名称不能重复
- 影响范围：创建/更新操作

### 6.2 显示规则

BR-CFG-005：类型标签颜色
- 触发条件：渲染类型字段
- 处理逻辑：
  - INVENTORY：蓝色（tag-info）
  - LOCATION：绿色（tag-success）
- 影响范围：Type 列

---

## 7. 异常处理

### 7.1 创建失败

错误场景：映射创建失败
错误提示：映射创建失败，请检查是否已存在相同配置
处理方式：显示错误提示，保持弹窗状态

### 7.2 重复映射

错误场景：原始字段已被映射
错误提示：该原始字段已被映射，请选择其他字段
处理方式：显示错误提示

---

## 8. 依赖说明

### 8.1 API 接口

接口：查询动态属性映射
- 路径：GET /api/dynproperty-mapping
- 详细设计：07-design.md#2.6
- 用途：查询映射配置列表

接口：创建动态属性映射
- 路径：POST /api/dynproperty-mapping
- 详细设计：07-design.md#2.6
- 用途：创建映射配置

接口：更新动态属性映射
- 路径：PUT /api/dynproperty-mapping/{id}
- 详细设计：07-design.md#2.6
- 用途：更新映射配置

接口：删除动态属性映射
- 路径：DELETE /api/dynproperty-mapping/{id}
- 详细设计：07-design.md#2.6
- 用途：删除映射配置

### 8.2 权限要求

- config:read：查询配置
- config:create：创建配置
- config:update：更新配置
- config:delete：删除配置

---

## 9. 国际化（i18n）

### 9.1 静态文案

页面标题：
- key：dynPropertyMapping.title
- 中文：动态属性映射
- 英文：Dynamic Property Mapping

按钮文案：
- key：dynPropertyMapping.create
- 中文：新建映射
- 英文：Create Mapping

### 9.2 枚举值翻译

枚举名：DynPropertyType
- INVENTORY：中文=库存属性 / 英文=Inventory
- LOCATION：中文=库位属性 / 英文=Location

---

## 10. 数据模型引用

### 10.1 涉及的实体

实体：DynPropertyMapping
- 详细定义：04-domain-model.md#6.1
- 本模块使用的属性：id、customField、originalField、type、createdTime

---

## 11. API 接口引用

### 11.1 查询接口

接口：查询动态属性映射
- 路径：GET /api/dynproperty-mapping
- 详细设计：07-design.md#2.6
- 用途：获取映射配置列表数据

### 11.2 命令接口

接口：创建动态属性映射
- 路径：POST /api/dynproperty-mapping
- 详细设计：07-design.md#2.6
- 用途：创建映射配置

接口：更新动态属性映射
- 路径：PUT /api/dynproperty-mapping/{id}
- 详细设计：07-design.md#2.6
- 用途：更新映射配置

接口：删除动态属性映射
- 路径：DELETE /api/dynproperty-mapping/{id}
- 详细设计：07-design.md#2.6
- 用途：删除映射配置

---

## 12. 验收标准引用

### 12.1 关联的验收标准

来源：03-requirements.md

AC-001（FR-CFG-001）：创建映射配置成功
- 对应交互：本文档 4.3 新建映射
- 验证方式：创建映射，验证创建成功

AC-002（FR-CFG-001）：查询映射配置成功
- 对应交互：本文档 4.2 查询映射
- 验证方式：查询映射，验证结果正确

### 12.2 前端特有验收标准

AC-FE-001：类型标签颜色正确
- 验证方式：验证不同类型显示不同颜色标签

AC-FE-002：表单验证正确
- 验证方式：必填字段为空时显示错误提示
