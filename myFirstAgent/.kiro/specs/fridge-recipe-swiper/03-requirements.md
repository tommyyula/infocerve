# 阶段 3: 需求规格 (Requirements)

## 功能需求 (Functional Requirements)

### FR-1: 图片上传模块

| ID | 需求描述 | 优先级 | 验收标准 |
|----|----------|--------|----------|
| FR-1.1 | 支持从设备相册选择图片 | P0 | 点击按钮可打开系统相册 |
| FR-1.2 | 支持直接拍照上传 | P0 | 点击按钮可调用摄像头 |
| FR-1.3 | 支持 JPG/PNG/HEIC 格式 | P0 | 三种格式均可正常上传 |
| FR-1.4 | 上传前显示图片预览 | P1 | 用户可在上传前预览所选图片 |
| FR-1.5 | 图片压缩（超过 5MB 自动压缩） | P1 | 大图片自动压缩后上传 |
| FR-1.6 | 上传进度显示 | P2 | 显示上传进度条 |

### FR-2: 食材识别模块

| ID | 需求描述 | 优先级 | 验收标准 |
|----|----------|--------|----------|
| FR-2.1 | 调用 Gemini API 识别图片中的食材 | P0 | 返回食材列表 |
| FR-2.2 | 显示识别出的食材列表 | P0 | 以标签形式展示 |
| FR-2.3 | 允许用户删除误识别的食材 | P0 | 点击 X 可删除 |
| FR-2.4 | 允许用户手动添加食材 | P1 | 输入框可添加新食材 |
| FR-2.5 | 显示识别加载状态 | P0 | 识别中显示 loading |
| FR-2.6 | 识别失败时显示错误提示 | P0 | 友好的错误信息 |

### FR-3: 食谱生成模块

| ID | 需求描述 | 优先级 | 验收标准 |
|----|----------|--------|----------|
| FR-3.1 | 基于食材列表生成食谱推荐 | P0 | 返回 3-5 个食谱 |
| FR-3.2 | 每个食谱包含名称 | P0 | 必须有菜名 |
| FR-3.3 | 每个食谱包含所需食材及用量 | P0 | 列出食材和用量 |
| FR-3.4 | 每个食谱包含烹饪步骤 | P0 | 分步骤说明 |
| FR-3.5 | 每个食谱包含预计烹饪时间 | P1 | 显示分钟数 |
| FR-3.6 | 每个食谱包含难度等级 | P2 | 简单/中等/困难 |
| FR-3.7 | 生成加载状态显示 | P0 | 生成中显示 loading |

### FR-4: 滑动选择模块

| ID | 需求描述 | 优先级 | 验收标准 |
|----|----------|--------|----------|
| FR-4.1 | 食谱以卡片形式展示 | P0 | 卡片 UI |
| FR-4.2 | 支持左滑手势（跳过） | P0 | 左滑卡片消失 |
| FR-4.3 | 支持右滑手势（收藏） | P0 | 右滑卡片消失并收藏 |
| FR-4.4 | 滑动动画流畅 | P1 | 60fps 无卡顿 |
| FR-4.5 | 支持点击按钮代替滑动 | P1 | X 按钮和 ❤️ 按钮 |
| FR-4.6 | 显示卡片堆叠效果 | P2 | 可见下一张卡片 |
| FR-4.7 | 所有卡片滑完后显示结果 | P0 | 显示收藏的食谱列表 |

### FR-5: 食谱详情模块

| ID | 需求描述 | 优先级 | 验收标准 |
|----|----------|--------|----------|
| FR-5.1 | 点击卡片查看完整食谱 | P0 | 弹出详情页 |
| FR-5.2 | 显示完整烹饪步骤 | P0 | 步骤列表 |
| FR-5.3 | 显示所需食材和用量 | P0 | 食材列表 |
| FR-5.4 | 显示预计烹饪时间 | P1 | 时间信息 |
| FR-5.5 | 支持返回滑动界面 | P0 | 关闭按钮 |

### FR-6: 数据持久化模块

| ID | 需求描述 | 优先级 | 验收标准 |
|----|----------|--------|----------|
| FR-6.1 | 保存用户收藏的食谱 | P0 | 收藏数据持久化 |
| FR-6.2 | 查看收藏列表 | P1 | 收藏页面 |
| FR-6.3 | 从收藏中删除食谱 | P1 | 支持取消收藏 |
| FR-6.4 | 保存最近浏览历史 | P2 | 历史记录 |

---

## 非功能需求 (Non-Functional Requirements)

### NFR-1: 性能需求

| ID | 需求描述 | 目标值 |
|----|----------|--------|
| NFR-1.1 | 页面首次加载时间 | < 3 秒 |
| NFR-1.2 | 图片上传响应时间 | < 5 秒（5MB 图片） |
| NFR-1.3 | AI 识别响应时间 | < 10 秒 |
| NFR-1.4 | 食谱生成响应时间 | < 15 秒 |
| NFR-1.5 | 滑动动画帧率 | >= 60 fps |

### NFR-2: 可用性需求

| ID | 需求描述 | 目标值 |
|----|----------|--------|
| NFR-2.1 | 移动端适配 | 支持 iOS Safari / Android Chrome |
| NFR-2.2 | PC 端适配 | 支持 Chrome / Firefox / Safari |
| NFR-2.3 | 最小屏幕宽度 | 320px |
| NFR-2.4 | 触摸操作支持 | 支持触摸滑动 |
| NFR-2.5 | 鼠标操作支持 | 支持鼠标拖拽 |

### NFR-3: 安全需求

| ID | 需求描述 | 说明 |
|----|----------|------|
| NFR-3.1 | API Key 安全 | Gemini API Key 仅在服务端使用 |
| NFR-3.2 | 图片隐私 | 上传图片不永久存储 |
| NFR-3.3 | HTTPS | 所有通信使用 HTTPS |

### NFR-4: 可靠性需求

| ID | 需求描述 | 目标值 |
|----|----------|--------|
| NFR-4.1 | API 错误处理 | 所有 API 调用有错误处理 |
| NFR-4.2 | 离线提示 | 无网络时显示提示 |
| NFR-4.3 | 重试机制 | AI API 失败时可重试 |

---

## 接口需求 (Interface Requirements)

### API 接口列表

| 接口 | 方法 | 路径 | 描述 |
|------|------|------|------|
| 上传图片 | POST | `/api/upload` | 上传食材图片 |
| 识别食材 | POST | `/api/recognize` | AI 识别食材 |
| 生成食谱 | POST | `/api/generate-recipes` | 生成食谱推荐 |
| 保存收藏 | POST | `/api/favorites` | 收藏食谱 |
| 获取收藏 | GET | `/api/favorites` | 获取收藏列表 |
| 删除收藏 | DELETE | `/api/favorites/:id` | 取消收藏 |

---

## 数据需求 (Data Requirements)

### 食材数据结构

```typescript
interface Ingredient {
  id: string;
  name: string;        // 食材名称
  quantity?: string;   // 数量（可选）
  confidence?: number; // AI 识别置信度
}
```

### 食谱数据结构

```typescript
interface Recipe {
  id: string;
  name: string;           // 菜名
  description: string;    // 简短描述
  ingredients: {          // 所需食材
    name: string;
    amount: string;
  }[];
  steps: string[];        // 烹饪步骤
  cookingTime: number;    // 烹饪时间（分钟）
  difficulty: 'easy' | 'medium' | 'hard';
  imageUrl?: string;      // 食谱图片（AI 生成描述）
}
```

### 收藏数据结构

```typescript
interface Favorite {
  id: string;
  recipeId: string;
  recipe: Recipe;
  createdAt: Date;
}
```

---

## 约束条件 (Constraints)

| 类型 | 约束 |
|------|------|
| 技术 | 前端使用 React + Vite |
| 技术 | 后端使用 Vercel Serverless Functions |
| 技术 | 数据库使用 Vercel KV |
| 技术 | AI 使用 Google Gemini API |
| 部署 | 部署到 Vercel |
| 时间 | MVP 版本 |
| 预算 | 使用免费/低成本服务 |

---

## 优先级说明

| 优先级 | 说明 | MVP 必须 |
|--------|------|----------|
| P0 | 核心功能，必须实现 | ✅ |
| P1 | 重要功能，应该实现 | ✅ |
| P2 | 增强功能，可以延后 | ❌ |

---

## 自检清单

- [x] 功能需求已详细列出
- [x] 每个需求有优先级和验收标准
- [x] 非功能需求已定义
- [x] API 接口已列出
- [x] 数据结构已定义
- [x] 约束条件已说明

---

**文档状态**: 待确认
**创建时间**: 2026-01-19
**版本**: 1.0
