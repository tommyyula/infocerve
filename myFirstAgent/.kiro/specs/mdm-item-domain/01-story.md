# MDM Item 领域 - 用户故事

## 背景

MDM（主数据管理）系统中的 Item（商品）领域是核心业务模块，负责管理商品主数据、商品属性、商品单位、套装组件和托盘配置等信息。

本次重新实现的目标：
1. 采用 DDD（领域驱动设计）架构重构 Item 领域
2. 简化表结构，删除冗余字段
3. 优化属性管理，采用冗余存储设计提升查询性能
4. 支持新增的业务场景（双单位、序列号验证规则等）

涉及的数据表：
- mdm_item - 商品主表
- mdm_item_property - 商品属性表
- mdm_item_hazard - 危险品定义表（独立管理）
- mdm_item_kitting - 套装组件表
- mdm_item_uom - 商品单位表
- mdm_pallet_config - 托盘配置表
- mdm_industry - 行业表
- mdm_industry_property_template - 行业属性模板表

---

## 系统菜单结构

商品后台管理系统包含以下三个菜单：

1. 行业管理 - 维护行业信息和行业自定义属性字段
2. 商品管理 - 商品列表、新建、编辑
3. 危险品管理 - 维护危险品定义

---

## 用户故事列表

### Story 1: 行业管理

**作为** 系统管理员
**我想要** 维护行业信息和行业属性模板
**以便于** 为不同行业的商品提供标准化的属性定义

#### 验收标准

- [ ] GIVEN 管理员在行业管理页面 WHEN 创建行业（代码、名称、描述） THEN 系统保存行业信息
- [ ] GIVEN 行业已存在 WHEN 修改行业名称或描述 THEN 系统更新行业信息
- [ ] GIVEN 行业已存在 WHEN 删除行业 THEN 系统检查是否有商品关联，有则拒绝删除
- [ ] GIVEN 同一租户下 WHEN 创建行业代码重复的行业 THEN 系统拒绝创建并提示代码已存在
- [ ] GIVEN 行业列表 WHEN 查询行业 THEN 系统按排序顺序返回行业列表

---

### Story 2: 行业属性模板管理

**作为** 系统管理员
**我想要** 为行业配置属性模板
**以便于** 新建商品时自动加载行业标准属性

#### 验收标准

- [ ] GIVEN 行业已创建 WHEN 添加属性模板（名称、类型、是否必填） THEN 系统保存属性模板
- [ ] GIVEN 属性模板类型为 SELECT WHEN 添加模板 THEN 系统保存选项列表
- [ ] GIVEN 属性模板类型为 NUMBER WHEN 添加模板 THEN 系统保存单位信息
- [ ] GIVEN 行业已有属性模板 WHEN 修改模板 THEN 系统更新模板信息
- [ ] GIVEN 行业已有属性模板 WHEN 删除模板 THEN 系统移除模板记录
- [ ] GIVEN 行业有多个属性模板 WHEN 调整排序 THEN 系统更新排序顺序

---

### Story 3: 危险品定义管理

**作为** 系统管理员
**我想要** 维护危险品定义信息
**以便于** 商品可以关联已定义的危险品类型

#### 验收标准

- [ ] GIVEN 管理员在危险品管理页面 WHEN 创建危险品定义（ID、名称、运输名称、分类、包装组） THEN 系统保存危险品定义
- [ ] GIVEN 危险品定义已存在 WHEN 修改危险品信息 THEN 系统更新危险品定义
- [ ] GIVEN 危险品定义已存在 WHEN 删除危险品定义 THEN 系统检查是否有商品关联，有则拒绝删除
- [ ] GIVEN 同一租户下 WHEN 创建危险品 ID 重复的定义 THEN 系统拒绝创建并提示 ID 已存在
- [ ] GIVEN 危险品列表 WHEN 查询危险品 THEN 系统返回危险品定义列表

---

### Story 4: 商品基础信息管理

**作为** 仓库管理员
**我想要** 创建和维护商品基础信息
**以便于** 在仓库作业中准确识别和管理商品

#### 验收标准

- [ ] GIVEN 管理员在商品管理页面 WHEN 填写 SKU、描述等必填信息并提交 THEN 系统创建商品并生成唯一 ID
- [ ] GIVEN 商品已存在 WHEN 修改商品描述、品牌等信息 THEN 系统更新商品信息并记录更新时间
- [ ] GIVEN 商品已存在 WHEN 查询商品详情 THEN 系统返回商品完整信息（包含属性、单位等关联数据）
- [ ] GIVEN 同一租户下 WHEN 创建 SKU 重复的商品 THEN 系统拒绝创建并提示 SKU 已存在
- [ ] GIVEN 商品关联了库存数据 WHEN 尝试删除商品 THEN 系统拒绝删除并提示存在关联数据

---

### Story 5: 商品选择行业加载属性

**作为** 仓库管理员
**我想要** 在新建商品时选择行业自动加载属性模板
**以便于** 快速配置商品的标准属性

#### 验收标准

- [ ] GIVEN 新建商品页面 WHEN 选择行业 THEN 系统加载该行业的所有属性模板
- [ ] GIVEN 属性模板已加载 WHEN 管理员删除某个属性 THEN 系统从列表中移除该属性
- [ ] GIVEN 属性模板已加载 WHEN 管理员添加自定义属性 THEN 系统在列表中新增属性
- [ ] GIVEN 属性模板已加载 WHEN 管理员填写属性值并保存 THEN 系统将属性保存到 mdm_item_property 表
- [ ] GIVEN 商品已保存属性 WHEN 切换行业 THEN 系统提示是否清空现有属性并重新加载
- [ ] GIVEN 属性模板标记为必填 WHEN 商品保存时未填写该属性 THEN 系统提示必填属性缺失

---

### Story 6: 商品单位管理

**作为** 仓库管理员
**我想要** 为商品配置多个计量单位
**以便于** 支持不同场景下的数量换算

#### 验收标准

- [ ] GIVEN 商品新建/编辑页面 WHEN 点击单位 Tab 的添加按钮 THEN 系统弹出单位维护模态框
- [ ] GIVEN 单位模态框 WHEN 填写单位信息并保存 THEN 系统将单位暂存到页面列表（不立即保存数据库）
- [ ] GIVEN 商品已有基本单位 WHEN 添加其他单位 THEN 系统保存单位及与基本单位的换算关系
- [ ] GIVEN 商品有多个单位 WHEN 设置默认单位 THEN 系统更新默认单位标记
- [ ] GIVEN 商品启用双单位 WHEN 配置双单位类型 THEN 系统保存双单位配置
- [ ] GIVEN 单位配置了尺寸信息 WHEN 查询单位 THEN 系统返回长宽高、重量、体积等信息
- [ ] GIVEN 单位配置了价格信息 WHEN 查询单位 THEN 系统返回价格、保险价格、币种等信息
- [ ] GIVEN 商品保存 WHEN 提交表单 THEN 系统将暂存的单位列表一并保存到数据库

---

### Story 7: 托盘配置管理

**作为** 仓库管理员
**我想要** 为商品配置托盘堆码规则
**以便于** 优化仓库存储空间利用

#### 验收标准

- [ ] GIVEN 商品新建/编辑页面 WHEN 点击 Pallet 配置 Tab 的添加按钮 THEN 系统弹出托盘配置模态框
- [ ] GIVEN 托盘配置模态框 WHEN 填写 TI/HI 等信息并保存 THEN 系统将配置暂存到页面列表
- [ ] GIVEN 商品有多个托盘配置 WHEN 设置默认配置 THEN 系统更新默认标记
- [ ] GIVEN 托盘配置关联零售商 WHEN 查询配置 THEN 系统按零售商筛选返回对应配置
- [ ] GIVEN 托盘配置关联场景 WHEN 查询配置 THEN 系统按场景筛选返回对应配置
- [ ] GIVEN 商品保存 WHEN 提交表单 THEN 系统将暂存的托盘配置列表一并保存到数据库

---

### Story 8: 套装商品管理

**作为** 仓库管理员
**我想要** 配置套装商品的组件信息
**以便于** 支持套装商品的组装和拆分作业

#### 验收标准

- [ ] GIVEN 商品新建/编辑页面 WHEN 打开 Kitting 开关 THEN 系统显示 Kitting Tab
- [ ] GIVEN Kitting Tab WHEN 点击添加组合品按钮 THEN 系统弹出商品选择模态框
- [ ] GIVEN 商品选择模态框 WHEN 选择商品并填写数量后保存 THEN 系统将组件暂存到页面列表
- [ ] GIVEN 套装已有组件 WHEN 修改组件数量 THEN 系统更新组件数量
- [ ] GIVEN 套装已有组件 WHEN 删除组件 THEN 系统移除组件记录
- [ ] GIVEN 套装商品 WHEN 查询套装详情 THEN 系统返回所有组件商品信息
- [ ] GIVEN 套装配置了履行方式 WHEN 创建订单 THEN 系统按配置的方式处理（整体发货或拆分发货）
- [ ] GIVEN 商品保存 WHEN 提交表单 THEN 系统将暂存的组件列表一并保存到数据库

---

### Story 9: 商品关联危险品

**作为** 仓库管理员
**我想要** 为商品关联危险品定义
**以便于** 确保危险品的合规存储和运输

#### 验收标准

- [ ] GIVEN 商品新建/编辑页面 WHEN 打开危险品开关 THEN 系统显示危险品选择框
- [ ] GIVEN 危险品选择框 WHEN 选择已维护的危险品定义 THEN 系统记录商品与危险品的关联
- [ ] GIVEN 商品已关联危险品 WHEN 查询商品 THEN 系统返回关联的危险品信息
- [ ] GIVEN 商品已关联危险品 WHEN 创建运输单 THEN 系统自动标记危险品标识
- [ ] GIVEN 商品已关联危险品 WHEN 关闭危险品开关 THEN 系统清除危险品关联

---

### Story 10: 商品条码管理

**作为** 收货员
**我想要** 通过扫描条码快速识别商品
**以便于** 提高收货作业效率

#### 验收标准

- [ ] GIVEN 商品已配置 EAN 码 WHEN 扫描 EAN 条码 THEN 系统识别并返回对应商品信息
- [ ] GIVEN 商品已配置 UPC 码 WHEN 扫描 UPC 条码 THEN 系统识别并返回对应商品信息
- [ ] GIVEN 商品已配置箱装 UPC 码 WHEN 扫描箱装条码 THEN 系统识别商品并自动换算为基本单位数量
- [ ] GIVEN 商品已配置 ISBN 码 WHEN 扫描 ISBN 条码 THEN 系统识别并返回对应商品信息
- [ ] GIVEN 条码不存在 WHEN 扫描未知条码 THEN 系统提示条码未找到

---

### Story 11: 商品序列号管理

**作为** 仓库管理员
**我想要** 配置商品的序列号收集规则
**以便于** 在收货和发货时准确追踪商品

#### 验收标准

- [ ] GIVEN 商品启用序列号 WHEN 配置收货时收集序列号 THEN 收货作业时系统强制要求录入序列号
- [ ] GIVEN 商品启用序列号 WHEN 配置发货时收集序列号 THEN 发货作业时系统强制要求录入序列号
- [ ] GIVEN 商品配置了序列号长度 WHEN 录入序列号 THEN 系统校验序列号长度是否符合要求
- [ ] GIVEN 商品配置了序列号验证规则 WHEN 录入序列号 THEN 系统按规则校验序列号格式
- [ ] GIVEN 商品未启用序列号 WHEN 进行收发货作业 THEN 系统不要求录入序列号

---

### Story 12: 商品批次管理

**作为** 仓库管理员
**我想要** 配置商品的批次信息收集规则
**以便于** 实现商品的批次追溯

#### 验收标准

- [ ] GIVEN 商品启用批次号 WHEN 配置收货时收集批次号 THEN 收货作业时系统强制要求录入批次号
- [ ] GIVEN 商品启用批次号 WHEN 配置发货时收集批次号 THEN 发货作业时系统强制要求录入批次号
- [ ] GIVEN 商品配置收集过期日期 WHEN 收货时 THEN 系统强制要求录入过期日期
- [ ] GIVEN 商品配置收集生产日期 WHEN 收货时 THEN 系统强制要求录入生产日期
- [ ] GIVEN 商品配置了保质期天数 WHEN 录入生产日期 THEN 系统自动计算过期日期

---

### Story 13: 商品列表查询

**作为** 仓库管理员
**我想要** 按条件查询商品列表
**以便于** 快速找到目标商品

#### 验收标准

- [ ] GIVEN 管理员在商品列表页面 WHEN 输入 SKU 关键字 THEN 系统返回匹配的商品列表
- [ ] GIVEN 管理员在商品列表页面 WHEN 按状态筛选 THEN 系统返回对应状态的商品
- [ ] GIVEN 管理员在商品列表页面 WHEN 按客户筛选 THEN 系统返回对应客户的商品
- [ ] GIVEN 管理员在商品列表页面 WHEN 按商品类型筛选 THEN 系统返回对应类型（物料/产品）的商品
- [ ] GIVEN 商品列表数据量大 WHEN 分页查询 THEN 系统返回分页结果并显示总数

---

### Story 14: 商品发货规则管理

**作为** 仓库管理员
**我想要** 配置商品的发货规则
**以便于** 控制商品的发货时效

#### 验收标准

- [ ] GIVEN 商品配置了保质期天数 WHEN 设置允许发货天数 THEN 系统保存发货天数限制
- [ ] GIVEN 商品配置了发货规则 WHEN 发货时商品剩余保质期不足 THEN 系统阻止发货并提示
- [ ] GIVEN 商品配置了发货规则时间窗口 WHEN 查询可发货商品 THEN 系统按时间窗口筛选
- [ ] GIVEN 商品配置了发货规则 WHEN 修改规则 THEN 系统更新发货规则配置

---

### Story 15: 商品批量导入

**作为** 仓库管理员
**我想要** 通过 Excel 文件批量导入商品数据
**以便于** 快速初始化大量商品信息

#### 验收标准

- [ ] GIVEN 管理员在商品列表页面 WHEN 点击导入按钮 THEN 系统跳转到导入页面
- [ ] GIVEN 导入页面 WHEN 点击下载模板 THEN 系统下载标准 Excel 模板文件
- [ ] GIVEN 导入页面 WHEN 上传 Excel 文件 THEN 系统解析文件并显示数据预览列表
- [ ] GIVEN 数据预览列表 WHEN 显示数据 THEN 系统展示 Item 基础字段映射区域
- [ ] GIVEN 数据预览列表 WHEN 显示数据 THEN 系统展示 Base UOM 字段映射区域
- [ ] GIVEN 数据预览列表 WHEN 显示数据 THEN 系统展示 Inner UOM 字段映射区域（可选）
- [ ] GIVEN 数据预览列表 WHEN 显示数据 THEN 系统展示 Case UOM 字段映射区域（可选）
- [ ] GIVEN 字段映射区域 WHEN 管理员选择 Excel 列与系统字段的对应关系 THEN 系统记录映射配置
- [ ] GIVEN 字段映射区域 WHEN 模板文件上传 THEN 系统根据模板列名自动匹配默认映射
- [ ] GIVEN 数据预览列表 WHEN 管理员确认导入 THEN 系统校验数据并执行批量导入
- [ ] GIVEN 导入执行中 WHEN 某行数据校验失败 THEN 系统记录错误信息并继续处理其他行
- [ ] GIVEN 导入完成 WHEN 显示结果 THEN 系统展示成功数量、失败数量和错误详情

---

### Story 16: 商品导入数据校验

**作为** 仓库管理员
**我想要** 系统在导入前校验数据的完整性和正确性
**以便于** 确保导入的商品数据符合业务规则

#### 验收标准

- [ ] GIVEN 导入数据 WHEN SKU 为空 THEN 系统标记该行为错误并提示 SKU 必填
- [ ] GIVEN 导入数据 WHEN SKU 在系统中已存在 THEN 系统标记该行为错误并提示 SKU 重复
- [ ] GIVEN 导入数据 WHEN 客户 ID 有值但不存在 THEN 系统标记该行为错误并提示客户不存在
- [ ] GIVEN 导入数据 WHEN 危险品 ID 有值但不存在 THEN 系统标记该行为错误并提示危险品定义不存在
- [ ] GIVEN 导入数据 WHEN 行业 ID 有值但不存在 THEN 系统标记该行为错误并提示行业不存在
- [ ] GIVEN 导入数据 WHEN 基本单位信息缺失 THEN 系统标记该行为错误并提示基本单位必填
- [ ] GIVEN 导入数据 WHEN 单位换算数量小于等于 0 THEN 系统标记该行为错误并提示换算数量无效
- [ ] GIVEN 导入数据 WHEN EAN 码格式不正确 THEN 系统标记该行为错误并提示 EAN 码格式无效
- [ ] GIVEN 导入数据 WHEN UPC 码格式不正确 THEN 系统标记该行为错误并提示 UPC 码格式无效

---

## 非功能需求

### 性能要求

- 商品列表查询响应时间小于 500ms（1000 条数据以内）
- 商品详情查询响应时间小于 200ms
- 条码扫描识别响应时间小于 100ms

### 数据一致性

- 商品 SKU 在同一租户下唯一
- 商品删除时需检查关联数据（库存、订单等）
- 属性、单位、套装组件的增删改需保持事务一致性

### 安全要求

- 商品数据按租户隔离
- 敏感操作（删除、批量修改）需记录操作日志

---

## 术语说明

- SKU（Stock Keeping Unit）- 库存单位，商品唯一标识
- UOM（Unit of Measure）- 计量单位
- TI（Tier）- 托盘每层数量
- HI（Height Index）- 托盘层数
- EAN（European Article Number）- 欧洲商品编码
- UPC（Universal Product Code）- 通用产品代码
- ISBN（International Standard Book Number）- 国际标准书号
- NMFC（National Motor Freight Classification）- 国家汽车货运分类
- 行业（Industry）- 商品所属的业务分类，如服装、食品、电子等
- 行业属性模板（Industry Property Template）- 行业预定义的标准属性，用于快速配置商品属性
- 危险品定义（Hazard Definition）- 预先维护的危险品类型，商品可关联
- Kitting - 套装/组合品，由多个组件商品组成
