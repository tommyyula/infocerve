# 用户故事编写规范（Story Guidelines）

## 概述

本规范定义了用户故事（User Story）的编写标准，确保需求描述清晰、可验证、可追溯。

### 相关规范

- **TDD 工作流程**：参见 `test-driven-development-workflow.md`
- **DDD 架构规范**：参见 `ddd-architecture.md`

---

## 文件位置

```
.kiro/specs/{feature-name}/story.md
```

---

## 模板结构

```markdown
# {功能名称} - 用户故事

## 背景
[描述功能的业务背景和价值，说明为什么需要这个功能]

## 用户故事列表

### Story 1: {故事标题}
**作为** {用户角色}
**我想要** {功能描述}
**以便于** {业务价值}

#### 验收标准
- [ ] 标准1
- [ ] 标准2
- [ ] 标准3

### Story 2: {故事标题}
**作为** {用户角色}
**我想要** {功能描述}
**以便于** {业务价值}

#### 验收标准
- [ ] 标准1
- [ ] 标准2
```

---

## 编写要点

### 1. 用户角色（As a...）

| 角色 | 说明 | 典型操作 |
|-----|------|---------|
| 仓库管理员 | 负责仓库整体管理 | 创建单据、审批、报表查看 |
| 收货员 | 负责入库收货 | 扫码收货、上架 |
| 拣货员 | 负责出库拣货 | 扫码拣货、确认出库 |
| 盘点员 | 负责库存盘点 | 盘点录入、差异处理 |
| 系统管理员 | 负责系统配置 | 用户管理、权限配置 |

### 2. 功能描述（I want to...）

- 使用动词开头
- 描述具体、可操作的动作
- 使用统一语言中的术语

```
✅ 正确：创建入库单并添加入库明细
✅ 正确：扫描物料条码录入收货数量
❌ 错误：管理入库（太模糊）
❌ 错误：处理数据（不具体）
```

### 3. 业务价值（So that...）

- 说明为什么需要这个功能
- 体现业务收益

```
✅ 正确：记录计划入库的物料信息，便于后续收货核对
✅ 正确：确保库存数据准确，支持后续追溯
❌ 错误：完成工作（无意义）
❌ 错误：系统需要（不是业务价值）
```

### 4. 验收标准（Acceptance Criteria）

验收标准必须满足 SMART 原则：

| 原则 | 说明 | 示例 |
|-----|------|------|
| Specific | 具体明确 | 输入数量后显示金额 |
| Measurable | 可测量 | 响应时间 < 2秒 |
| Achievable | 可实现 | 技术上可行 |
| Relevant | 相关性 | 与故事目标相关 |
| Testable | 可测试 | 可以编写测试用例 |

---

## 验收标准编写格式

### Given-When-Then 格式（推荐）

```markdown
#### 验收标准
- [ ] GIVEN 入库单状态为"待收货" WHEN 录入收货数量 THEN 系统更新已收数量
- [ ] GIVEN 收货数量超过计划110% WHEN 提交收货 THEN 系统显示超量警告
- [ ] GIVEN 所有明细收货完成 WHEN 确认完成 THEN 入库单状态变为"已完成"
```

### 简洁格式

```markdown
#### 验收标准
- [ ] 可以选择供应商
- [ ] 可以添加多条入库明细
- [ ] 保存后生成唯一入库单号
- [ ] 收货数量超过计划110%时提示警告
```

---

## 故事拆分原则

### INVEST 原则

| 原则 | 说明 |
|-----|------|
| Independent | 故事之间尽量独立 |
| Negotiable | 可协商，不是合同 |
| Valuable | 对用户有价值 |
| Estimable | 可估算工作量 |
| Small | 足够小，一个迭代可完成 |
| Testable | 可测试验证 |

### 拆分方法

| 方法 | 说明 | 示例 |
|-----|------|------|
| 按用户角色 | 不同角色的操作分开 | 管理员创建 vs 操作员执行 |
| 按操作类型 | CRUD 分开 | 创建、查询、修改、删除 |
| 按业务流程 | 流程步骤分开 | 创建单据 → 执行 → 完成 |
| 按数据变化 | 简单到复杂 | 单条 → 批量 |
| 按界面 | 不同界面分开 | 列表页 vs 详情页 |

---

## 完整示例

```markdown
# 入库管理 - 用户故事

## 背景
仓库需要记录物料入库过程，确保库存数据准确，支持后续追溯。
当前人工记录容易出错，需要系统化管理入库流程。

## 用户故事列表

### Story 1: 创建入库单
**作为** 仓库管理员
**我想要** 创建入库单并添加入库明细
**以便于** 记录计划入库的物料信息，便于后续收货核对

#### 验收标准
- [ ] 可以选择供应商
- [ ] 可以添加多条入库明细
- [ ] 每条明细包含物料、计划数量、批次号
- [ ] 保存后生成唯一入库单号（格式：IN + 年月日 + 序号）
- [ ] 新建入库单状态为"草稿"

### Story 2: 确认入库单
**作为** 仓库管理员
**我想要** 确认入库单
**以便于** 通知收货员准备收货

#### 验收标准
- [ ] 只有"草稿"状态的入库单可以确认
- [ ] 确认前校验至少有一条入库明细
- [ ] 确认后状态变为"待收货"
- [ ] 确认后不可修改入库明细

### Story 3: 执行收货
**作为** 收货员
**我想要** 扫码录入实际收货数量
**以便于** 记录实际到货情况，更新库存

#### 验收标准
- [ ] 支持扫描物料条码快速定位明细
- [ ] 可以输入实际收货数量
- [ ] 可以选择上架库位
- [ ] GIVEN 收货数量超过计划110% WHEN 提交 THEN 显示超量警告需确认
- [ ] 收货完成后自动增加对应库位库存

### Story 4: 完成入库单
**作为** 仓库管理员
**我想要** 完成入库单
**以便于** 结束入库流程，生成入库记录

#### 验收标准
- [ ] 只有"待收货"状态的入库单可以完成
- [ ] 完成后状态变为"已完成"
- [ ] 完成后生成库存变动记录
- [ ] 完成后不可再修改

### Story 5: 查询入库单
**作为** 仓库管理员
**我想要** 按条件查询入库单
**以便于** 快速找到需要的入库记录

#### 验收标准
- [ ] 支持按入库单号精确查询
- [ ] 支持按供应商筛选
- [ ] 支持按状态筛选
- [ ] 支持按创建日期范围筛选
- [ ] 列表显示单号、供应商、状态、创建时间
- [ ] 支持分页，每页默认20条
```

---

## 检查清单

### 故事完整性
- [ ] 有明确的用户角色
- [ ] 功能描述具体可操作
- [ ] 业务价值清晰
- [ ] 使用统一语言中的术语

### 验收标准质量
- [ ] 每个故事至少3条验收标准
- [ ] 验收标准可测试、可验证
- [ ] 覆盖正常流程
- [ ] 覆盖边界情况和异常情况
- [ ] 包含必要的业务规则

### 故事质量
- [ ] 符合 INVEST 原则
- [ ] 故事大小适中（1-3天可完成）
- [ ] 故事之间依赖关系清晰

---

## 常见问题

### Q: 一个功能应该拆成几个故事？
A: 按 INVEST 原则，每个故事应该在1-3天内可完成。如果太大就拆分，太小就合并。

### Q: 验收标准写多少条合适？
A: 通常3-8条。太少可能遗漏场景，太多说明故事太大需要拆分。

### Q: 技术任务算用户故事吗？
A: 不算。技术任务（如重构、性能优化）应该单独管理，或作为故事的子任务。

---

## 下一步

完成 `story.md` 后，进入领域分析阶段，编写 `domain-analysis.md`。
