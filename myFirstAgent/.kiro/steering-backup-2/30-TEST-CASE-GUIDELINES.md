---
inclusion: manual
---

# 测试用例编写规范（Test Case Guidelines）

## 概述

本规范定义了测试用例文档的编写标准，包括 E2E 测试、单元测试和 API 测试。

---

## 文件位置

```
.kiro/specs/{feature-name}/
  e2e-test-cases.md          # 端到端测试用例
  unit-test-cases.md         # 单元测试用例
  api-test-cases.md          # API 测试用例
```

---

## 测试金字塔

```
        /\
       /  \
      / E2E \        少量，验证核心流程
     /--------\
    /   API    \     中量，验证接口契约
   /--------------\
  /     Unit       \  大量，验证业务逻辑
 /------------------\
```

E2E - 少量，执行慢，覆盖端到端流程
API - 中量，执行中，覆盖接口契约
Unit - 大量，执行快，覆盖业务逻辑

---

## E2E 测试用例

### 模板

```markdown
### E2E-001: {测试标题}

**关联需求**：需求 X.Y
**关联故事**：Story X
**优先级**：P0/P1/P2

**前置条件**：
- 条件1
- 条件2

**测试步骤**：
1. 步骤1
2. 步骤2

**预期结果**：
- 结果1
- 结果2

**测试数据**：
- 数据1
- 数据2
```

### 编写规则

1. 覆盖核心流程 - 优先覆盖主要业务流程
2. 多端协作 - 包含 PC 端和手持端的协作场景
3. 数据准备 - 明确前置条件和测试数据
4. 结果验证 - 验证所有相关系统的状态变化

---

## 单元测试用例

### 值对象测试模板

```markdown
### UT-VO-001: {值对象名} - {测试场景}

**关联值对象**：{值对象名}
**测试类型**：值对象测试

**测试场景**：
- 场景描述

**输入**：
- 输入数据

**预期结果**：
- 预期输出或异常
```

### 聚合测试模板

```markdown
### UT-AGG-001: {聚合名} - {测试场景}

**关联聚合**：{聚合名}
**关联方法**：{方法名}
**关联业务规则**：BR-XXX-001
**测试类型**：聚合根测试

**测试场景**：
- 场景描述

**前置状态**：
- 聚合初始状态

**输入**：
- 方法参数

**预期结果**：
- 状态变化
- 事件发布
```

### 领域服务测试模板

```markdown
### UT-DS-001: {服务名} - {测试场景}

**关联服务**：{服务名}
**关联方法**：{方法名}
**测试类型**：领域服务测试

**测试场景**：
- 场景描述

**Mock 依赖**：
- 依赖1
- 依赖2

**输入**：
- 方法参数

**预期结果**：
- 返回值或异常
```

### 编写规则

1. 按类型分组 - 值对象、聚合、领域服务分开
2. 关联业务规则 - 每个测试关联具体的业务规则
3. 正反用例 - 包含正常场景和异常场景
4. 状态验证 - 验证状态变化和事件发布

---

## API 测试用例

### 模板

```markdown
### API-001: {API 名称} - {测试场景}

**关联需求**：需求 X.Y
**API**：{METHOD} {PATH}
**测试类型**：正常/异常/边界

**请求**：
{JSON 请求体}

**预期响应**：
- HTTP 状态码：200
- 响应体：{JSON 响应体}

**验证点**：
- 验证点1
- 验证点2
```

### 编写规则

1. 覆盖所有 API - 每个 API 至少有正常和异常用例
2. 请求响应完整 - 包含完整的请求和响应示例
3. 验证点明确 - 明确需要验证的内容
4. 边界测试 - 包含边界值测试

---

## 测试用例编号规范

- E2E 测试 - E2E-001
- 值对象测试 - UT-VO-001
- 聚合测试 - UT-AGG-001
- 领域服务测试 - UT-DS-001
- 应用服务测试 - UT-AS-001
- API 测试 - API-001

---

## 优先级定义

- P0 - 核心功能，必须通过，每次提交执行
- P1 - 重要功能，应该通过，每次提交执行
- P2 - 一般功能，建议通过，发布前执行
- P3 - 边缘场景，可选，定期执行

---

## 检查清单

E2E 测试：
- [ ] 覆盖核心业务流程
- [ ] 包含多端协作场景
- [ ] 前置条件完整
- [ ] 测试数据明确

单元测试：
- [ ] 覆盖所有值对象
- [ ] 覆盖所有聚合方法
- [ ] 覆盖所有领域服务
- [ ] 包含正常和异常场景
- [ ] 关联业务规则

API 测试：
- [ ] 覆盖所有 API
- [ ] 包含正常、异常、边界场景
- [ ] 请求响应示例完整
- [ ] 验证点明确

---

## 下一步

完成测试用例文档后，进入实现阶段，使用 task-manager 管理任务。

---

最后更新：2026-01-03
